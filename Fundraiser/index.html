<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Startup Funding Portal — Professional</title>
  <meta name="description" content="Find Government, Private & Global Funding, step-by-step application guides, and apply online — built for Indian startups." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#06b6d4; --accent-2:#34d399; --glass: rgba(255,255,255,0.04);
      --max-width:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
      background: linear-gradient(180deg,#071029 0%, #0f1724 100%); color:#e6eef6; -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale; line-height:1.5;
    }
    .container{width:95%;max-width:var(--max-width);margin:0 auto;padding:28px 0}

    /* NAV */
    header.site-header{position:sticky;top:0;z-index:40;background:linear-gradient(90deg, rgba(6,11,18,0.6), rgba(6,11,18,0.35));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03)}
    .nav{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#042;box-shadow:0 6px 18px rgba(3, 105, 161, 0.12)}
    .brand h1{font-size:1.05rem;margin:0}
    nav.primary{display:flex;gap:14px;align-items:center}
    nav.primary a{color:var(--muted);text-decoration:none;font-weight:600;padding:8px 10px;border-radius:8px}
    nav.primary a.active, nav.primary a:hover{color:#fff;background:rgba(255,255,255,0.03)}
    .cta{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#042;padding:8px 12px;border-radius:8px;font-weight:700}

    /* HERO */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center;padding:40px 0}
    .hero .intro h2{font-size:2rem;margin:0 0 8px}
    .hero .intro p{color:var(--muted);margin:0 0 18px}
    .search-box{display:flex;gap:12px;background:var(--card);padding:12px;border-radius:12px;align-items:center;border:1px solid rgba(255,255,255,0.03)}
    .search-box input{flex:1;background:transparent;border:0;outline:none;color:#e6eef6;font-weight:600}
    .pill{display:inline-block;background:var(--glass);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:0.85rem}

    /* CARDS GRID */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 6px 18px rgba(2,6,23,0.7)}
    .card h3{margin:0 0 8px;font-size:1.05rem}
    .meta{color:var(--muted);font-size:0.9rem}
    .actions{display:flex;gap:10px;margin-top:12px}
    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.primary{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#042}

    /* FILTERS */
    .filters{display:flex;gap:10px;align-items:center}
    .select, .input {background:#ffffff;border:1px solid #ddd;padding:8px 10px;border-radius:8px;color:#000000;font-weight:600}
    .select:focus, .input:focus {outline:none;border-color:#06b6d4;box-shadow:0 0 0 2px rgba(6,182,212,0.1)}

    /* TWO COLUMN SECTION */
    .split{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin-top:26px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}

    /* FORM STYLES */
    label{display:block;margin-bottom:6px;color:#333;font-size:0.9rem;font-weight:600}
    input[type=text], input[type=email], input[type=tel], textarea, select{width:100%;padding:10px;border-radius:8px;background:#f8f9fa;border:1px solid #ddd;color:#000;font-weight:500}
    input:focus, textarea:focus, select:focus{outline:none;border-color:#06b6d4;box-shadow:0 0 0 2px rgba(6,182,212,0.1)}
    textarea{min-height:120px}
    .muted{color:var(--muted);font-size:0.9rem}

    /* FOOTER */
    footer{padding:24px 0;color:var(--muted);text-align:center;margin-top:40px}

    /* RESPONSIVE */
    @media (max-width:980px){
      .hero{grid-template-columns:1fr}
      .grid{grid-template-columns:repeat(2,1fr)}
      .split{grid-template-columns:1fr}
    }
    @media (max-width:620px){
      .grid{grid-template-columns:1fr}
      nav.primary{display:none}
      .nav{justify-content:space-between}
    }

    /* small helpers */
    .tag{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:0.82rem;color:var(--muted)}
    .pill-2{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px}

  </style>
</head>
<body>
  <header class="site-header">
    <div class="container nav">
      <div class="brand">
        <div class="logo">SF</div>
        <div>
          <h1>Startup Funding Portal</h1>
          <div class="muted" style="font-size:0.85rem">Government & Private funding — India</div>
        </div>
      </div>

      <nav class="primary" aria-label="Primary navigation">
        <a href="#government" class="active">Government</a>
        <a href="#investors">Private</a>
        <a href="#global">Global</a>
        <a href="#apply">Apply</a>
        <a href="#howto">How to Apply</a>
        <a href="#news">News</a>
        <a href="#contact">Contact</a>
        <a href="#community">Community</a>
        <button class="cta" onclick="openModal('login')">Login</button>
        <button class="btn ghost" onclick="openModal('signup')" style="margin-left:8px;color:#fff">Sign up</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO -->
    <section class="hero">
      <div class="intro">
        <h1>Find funding, apply with confidence, grow faster.</h1>
        <p class="muted">Curated central & state government schemes, private investors, step-by-step application flows and a single place to manage applications.</p>

        <div class="search-box" role="search" aria-label="Search funding schemes">
          <input id="globalSearch" placeholder="Search schemes, investors, or keywords (eg: agritech, seed fund)" oninput="liveSearch()" />
          <div class="pill">4,200+ schemes</div>
        </div>

        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <div class="tag">Early-stage</div>
          <div class="tag">Seed Grants</div>
          <div class="tag">Govt & VC</div>
          <div class="muted" style="margin-left:auto">Need help? <a href="#contact" style="color:var(--accent);text-decoration:none">Contact expert</a></div>
        </div>

        <!-- quick stats -->
        <div style="display:flex;gap:12px;margin-top:18px;align-items:center">
          <div class="pill-2">Schemes: <strong id="schemeCount" style="color:#fff;margin-left:6px">0</strong></div>
          <div class="pill-2">VCs: <strong id="vcCount" style="color:#fff;margin-left:6px">0</strong></div>
          <div class="pill-2">Applied (demo): <strong style="color:#fff;margin-left:6px">12</strong></div>
        </div>
      </div>

      <!-- Right column: featured schemes -->
      <aside style="width:100%;max-width:420px">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Featured</div>
              <h3 style="margin:6px 0">Startup India Seed Fund</h3>
              <div class="meta">Grants up to ₹50 L for early-stage startups (prototype, proof-of-concept)</div>
            </div>
            <div style="text-align:right">
              <div class="tag">Govt</div>
              <div style="height:8px"></div>
              <button class="btn primary" onclick="openSchemeDetailsByName('Startup India Seed Fund')">Learn</button>
            </div>
          </div>
          <div style="height:12px"></div>
          <div class="muted" style="font-size:0.9rem">Eligibility: Incorporated entity, innovative product, Indian startup</div>
        </div>

        <div style="height:12px"></div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Top Investor</div>
              <h3 style="margin:6px 0">Indian Angel Network</h3>
              <div class="meta">Angels and syndicates investing in early-stage across sectors</div>
            </div>
            <div style="text-align:right">
              <div class="tag">Private</div>
              <div style="height:8px"></div>
              <button class="btn ghost" onclick="openInvestorByName('Indian Angel Network')">Profile</button>
            </div>
          </div>
        </div>
      </aside>
    </section>

    <!-- FILTERS & GRID -->
    <section id="government" style="margin-top:6px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h2 style="margin:0">Government Schemes</h2>
        <div class="filters">
          <select id="stateFilter" class="select" onchange="applyFilters()">
            <option value="all">All States / Central</option>
            <option value="central">Central Government</option>
            <option value="global">Global Schemes</option>
            <option value="andhrapradesh">Andhra Pradesh</option>
            <option value="assam">Assam</option>
            <option value="bihar">Bihar</option>
            <option value="chhattisgarh">Chhattisgarh</option>
            <option value="delhi">Delhi</option>
            <option value="goa">Goa</option>
            <option value="gujarat">Gujarat</option>
            <option value="haryana">Haryana</option>
            <option value="himachalpradesh">Himachal Pradesh</option>
            <option value="jharkhand">Jharkhand</option>
            <option value="karnataka">Karnataka</option>
            <option value="kerala">Kerala</option>
            <option value="madhyapradesh">Madhya Pradesh</option>
            <option value="maharashtra">Maharashtra</option>
            <option value="manipur">Manipur</option>
            <option value="meghalaya">Meghalaya</option>
            <option value="mizoram">Mizoram</option>
            <option value="nagaland">Nagaland</option>
            <option value="odisha">Odisha</option>
            <option value="punjab">Punjab</option>
            <option value="rajasthan">Rajasthan</option>
            <option value="sikkim">Sikkim</option>
            <option value="tamilnadu">Tamil Nadu</option>
            <option value="telangana">Telangana</option>
            <option value="tripura">Tripura</option>
            <option value="up">Uttar Pradesh</option>
            <option value="uttarakhand">Uttarakhand</option>
            <option value="westbengal">West Bengal</option>
          </select>
          <select id="stageFilter" class="select" onchange="applyFilters()">
            <option value="all">Any Stage</option>
            <option value="idea">Idea Stage</option>
            <option value="early">Early Stage</option>
            <option value="growth">Growth Stage</option>
            <option value="series-a">Series A</option>
            <option value="series-b">Series B</option>
          </select>
          <select id="sectorFilter" class="select" onchange="applyFilters()">
            <option value="all">All Sectors</option>
            <option value="tech">Technology</option>
            <option value="agri">Agriculture & Food</option>
            <option value="health">Healthcare & Biotech</option>
            <option value="fintech">Fintech</option>
            <option value="energy">Energy & Environment</option>
            <option value="education">Education</option>
            <option value="manufacturing">Manufacturing</option>
            <option value="retail">Retail & E-commerce</option>
            <option value="logistics">Logistics & Transport</option>
          </select>
        </div>
      </div>

      <div id="govGrid" class="grid" style="margin-top:14px"></div>
    </section>

    <!-- Global Funding Section -->
    <section id="global" style="margin-top:26px;display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h2 style="margin:0">Global Funding Schemes</h2>
        <div class="filters">
          <select id="globalStageFilter" class="select" onchange="applyGlobalFilters()">
            <option value="all">All Stages</option>
            <option value="idea">Idea Stage</option>
            <option value="early">Early Stage</option>
            <option value="growth">Growth Stage</option>
            <option value="series-a">Series A</option>
          </select>
          <select id="globalSectorFilter" class="select" onchange="applyGlobalFilters()">
            <option value="all">All Sectors</option>
            <option value="tech">Technology</option>
            <option value="fintech">Fintech</option>
            <option value="health">Healthcare</option>
            <option value="retail">E-commerce</option>
            <option value="saas">SaaS</option>
          </select>
        </div>
      </div>

      <div id="globalGrid" class="grid" style="margin-top:14px"></div>
    </section>

    <!-- Split section: private investors + apply form -->
    <section id="investors" class="split">
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h2 style="margin:0">Private Investors & Accelerators</h2>
          <div class="muted">Sort: <select id="sortInvestors" class="select" onchange="fetchInvestors()">
            <option value="createdAt">Relevance</option>
            <option value="stage">Stage</option>
            </select></div>
        </div>

        <div id="investorGrid" class="grid" style="margin-top:14px"></div>
      </div>

      <aside>
        <div class="panel">
          <h3 style="margin-top:0">Apply for Funding (Quick)</h3>
          <p class="muted">Fill this quick form and we will match you to relevant schemes & investors.</p>
          <form id="quickApply" onsubmit="handleQuickApply(event)">
            <label for="sname">Startup / Founder name</label>
            <input id="sname" type="text" placeholder="Example: GreenFarm Technologies" required />

            <label for="email">Contact email</label>
            <input id="email" type="email" placeholder="founder@startup.com" required />

            <label for="sector">Sector</label>
            <select id="sector">
              <option value="tech">Technology</option>
              <option value="agri">Agriculture & Food</option>
              <option value="health">Healthcare & Biotech</option>
              <option value="fintech">Fintech</option>
              <option value="energy">Energy & Environment</option>
              <option value="education">Education</option>
              <option value="manufacturing">Manufacturing</option>
              <option value="all">All Sectors</option>
            </select>

            <label for="stage">Stage</label>
            <select id="stage">
              <option value="idea">Idea Stage</option>
              <option value="early">Early Stage</option>
              <option value="growth">Growth Stage</option>
              <option value="series-a">Series A</option>
            </select>

            <label for="summary">One-line summary</label>
            <input id="summary" type="text" placeholder="Short description (20 words)" />

            <div style="display:flex;gap:10px;margin-top:12px">
              <button type="submit" class="btn primary">Find Matches</button>
              <button type="button" class="btn ghost" onclick="window.location.href='apply.html'">Full Application</button>
            </div>
          </form>
        </div>

        <div style="height:16px"></div>
        <div class="panel">
          <h4 style="margin:0">Tips before applying</h4>
          <ul class="muted" style="margin-top:8px">
            <li>Have your company registration and KYC ready.</li>
            <li>Prepare a crisp pitch deck (10-12 slides).</li>
            <li>List key milestones and fund utilization plan.</li>
            <li>Check eligibility carefully — each scheme differs.</li>
          </ul>
        </div>
      </aside>
    </section>

    <!-- How to Apply -->
    <section id="howto" style="margin-top:26px">
      <div class="panel">
        <h2>How to apply — step by step</h2>
        <ol style="color:var(--muted);">
          <li>Search & filter schemes by stage, sector and state — use the quick search.</li>
          <li>Read eligibility & required documents on the scheme page.</li>
          <li>Prepare documents: incorporation, PAN, bank details, pitch deck, financials.</li>
          <li>Apply online — either through the official scheme portal (link provided) or via investor submission.</li>
          <li>Follow up and be ready for evaluation or pitch rounds.</li>
        </ol>
      </div>
    </section>

    <!-- News & Upcoming -->
    <section id="news" style="margin-top:26px">
      <div style="display:flex;gap:18px">
        <div style="flex:2">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h2 style="margin:0">📢 Latest Updates & Upcoming Schemes</h2>
            <button class="btn ghost" onclick="subscribeToUpdates()" style="font-size:0.85rem">🔔 Subscribe to Updates</button>
          </div>
          <div id="latestUpdates"></div>
        </div>

        <aside style="flex:1">
          <div class="panel">
            <h4 style="margin:0">📊 Update Statistics</h4>
            <div style="margin-top:12px">
              <div class="pill-2" style="margin-bottom:8px">New Schemes: <strong id="newSchemesCount" style="color:#10b981">0</strong></div>
              <div class="pill-2" style="margin-bottom:8px">Subscribers: <strong id="subscribersCount" style="color:#06b6d4">0</strong></div>
              <div class="pill-2">Last Update: <strong id="lastUpdateTime" style="color:#f59e0b">-</strong></div>
            </div>
          </div>
          
          <div class="panel" style="margin-top:16px">
            <h4 style="margin:0">Resources</h4>
            <ul class="muted" style="margin-top:10px">
              <li>Startup India portal</li>
              <li>Invest India</li>
              <li>State Startup Portals</li>
            </ul>
          </div>
        </aside>
      </div>
    </section>

    <!-- Community Discussion Section -->
    <section id="community" style="margin-top:26px">
      <div class="panel">
        <h2>💬 Community Discussion Forum</h2>
        <p class="muted">Connect with founders, mentors, and investors. Share insights, ask questions, and build your network.</p>
        
        <div style="display:flex;gap:12px;margin:16px 0;align-items:center;flex-wrap:wrap">
          <select id="discussionFilter" class="select" onchange="filterDiscussions()">
            <option value="all">All Discussions</option>
            <option value="funding">💰 Funding Questions</option>
            <option value="mentorship">🎯 Mentorship</option>
            <option value="networking">🤝 Networking</option>
            <option value="resources">📚 Resources</option>
          </select>
          <button class="btn primary" onclick="openNewDiscussion()">+ Start Discussion</button>
        </div>
        
        <div id="discussionsList" style="margin-top:20px"></div>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact" style="margin-top:26px">
      <div class="panel">
        <h2>Contact & Support</h2>
        <p class="muted">Need help preparing documents or finding the right program? Reach out to our support team.</p>
        <form onsubmit="handleContact(event)">
          <label for="cname">Name</label>
          <input id="cname" type="text" required />
          <label for="cemail">Email</label>
          <input id="cemail" type="email" required />
          <label for="cmessage">Message</label>
          <textarea id="cmessage" placeholder="Describe your startup or question"></textarea>
          <div style="margin-top:12px"><button class="btn primary">Send</button></div>
        </form>
      </div>
    </section>

    <footer>
      <div class="muted">© 2025 Startup Funding Portal — Built with care • Privacy • Terms</div>
    </footer>
  </main>

  <!-- MODALS -->
  <div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60">
    <div style="position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.6),rgba(2,6,23,0.8))" onclick="closeModal()"></div>
    <div id="modalCard" style="position:relative;z-index:61;width:95%;max-width:820px;border-radius:12px;padding:18px;background:#ffffff;border:1px solid #ddd;box-shadow:0 10px 30px rgba(0,0,0,0.3)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle" style="margin:0;color:#000">Modal</h3>
        <button class="btn ghost" onclick="closeModal()">Close</button>
      </div>
      <div id="modalBody" style="margin-top:12px;color:#333"></div>
    </div>
  </div>

  <script>
    // Dynamic schemes database with auto-update capability
    let schemes = JSON.parse(localStorage.getItem('activeSchemes')) || [
      // Central Government Schemes
      {_id:'1',name:'Startup India Seed Fund',desc:'Financial assistance up to ₹50L for proof of concept and prototype development',state:'central',stage:'early',sector:'all',eligibility:'DPIIT recognized startups',link:'https://www.startupindia.gov.in/content/sih/en/sisfs.html',applyLink:'https://www.startupindia.gov.in/content/sih/en/sisfs.html'},
      {_id:'2',name:'BIRAC BioNEST',desc:'Biotechnology incubation program supporting life sciences startups',state:'central',stage:'early',sector:'health',eligibility:'Biotech/life sciences startups',link:'https://birac.nic.in/webcontent/1467_1_BioNEST.aspx',applyLink:'https://birac.nic.in/webcontent/1467_1_BioNEST.aspx'},
      {_id:'3',name:'NIDHI PRAYAS',desc:'Pre-incubation support up to ₹10L for technology-based ideas',state:'central',stage:'idea',sector:'tech',eligibility:'Students, faculty with tech ideas',link:'https://www.nstedb.com/institutional/prayas.htm',applyLink:'https://www.nstedb.com/institutional/prayas.htm'},
      {_id:'4',name:'Atal Innovation Mission',desc:'Innovation promotion platform with funding support',state:'central',stage:'early',sector:'all',eligibility:'Innovative scalable solutions',link:'https://aim.gov.in/',applyLink:'https://aim.gov.in/'},
      {_id:'5',name:'MUDRA Yojana',desc:'Micro-finance scheme up to ₹10L for small businesses',state:'central',stage:'early',sector:'all',eligibility:'Non-corporate small enterprises',link:'https://www.mudra.org.in/',applyLink:'https://www.mudra.org.in/'},
      {_id:'6',name:'Stand Up India',desc:'Bank loans ₹10L-₹1Cr for SC/ST and women entrepreneurs',state:'central',stage:'early',sector:'all',eligibility:'SC/ST and women entrepreneurs',link:'https://www.standupmitra.in/',applyLink:'https://www.standupmitra.in/'},
      {_id:'7',name:'ASPIRE Scheme',desc:'Rural entrepreneurship promotion up to ₹25L',state:'central',stage:'early',sector:'agri',eligibility:'Rural entrepreneurs, agri-business',link:'https://msme.gov.in/schemes-initiatives/schemes/aspire',applyLink:'https://msme.gov.in/schemes-initiatives/schemes/aspire'},
      {_id:'8',name:'Technology Development Fund',desc:'Support for technology development up to ₹50L',state:'central',stage:'early',sector:'tech',eligibility:'Technology-based startups',link:'https://www.nstedb.com/institutional/tdf.htm',applyLink:'https://www.nstedb.com/institutional/tdf.htm'},
      {_id:'9',name:'SISFS - Seed Support',desc:'Seed funding for startups with innovative ideas',state:'central',stage:'idea',sector:'all',eligibility:'Early-stage startups',link:'https://startupindia.gov.in',applyLink:'https://startupindia.gov.in'},
      {_id:'10',name:'National SC-ST Hub',desc:'Procurement support for SC/ST entrepreneurs',state:'central',stage:'growth',sector:'all',eligibility:'SC/ST owned enterprises',link:'https://www.nssh.gov.in/',applyLink:'https://www.nssh.gov.in/'},
      
      // Andhra Pradesh
      {_id:'11',name:'AP Innovation Society',desc:'State innovation fund up to ₹25L',state:'andhrapradesh',stage:'early',sector:'tech',eligibility:'AP registered startups',link:'https://innovation.ap.gov.in/',applyLink:'https://innovation.ap.gov.in/'},
      {_id:'12',name:'AP Agri Business Fund',desc:'Agriculture technology funding up to ₹15L',state:'andhrapradesh',stage:'early',sector:'agri',eligibility:'Agri-tech startups in AP',link:'https://www.apagrisnet.gov.in/',applyLink:'https://www.apagrisnet.gov.in/'},
      
      // Assam
      {_id:'13',name:'Assam Startup Policy',desc:'Comprehensive startup support up to ₹20L',state:'assam',stage:'early',sector:'all',eligibility:'Assam based startups',link:'https://industries.assam.gov.in/',applyLink:'https://industries.assam.gov.in/'},
      {_id:'14',name:'Assam Agri Startup Fund',desc:'Agriculture innovation support',state:'assam',stage:'early',sector:'agri',eligibility:'Agricultural startups',link:'https://agri.assam.gov.in/',applyLink:'https://agri.assam.gov.in/'},
      
      // Bihar
      {_id:'15',name:'Bihar Startup Policy',desc:'State startup fund up to ₹15L',state:'bihar',stage:'early',sector:'all',eligibility:'Bihar registered entities',link:'https://startup.bihar.gov.in/',applyLink:'https://startup.bihar.gov.in/'},
      {_id:'16',name:'Bihar Innovation Fund',desc:'Technology innovation support',state:'bihar',stage:'idea',sector:'tech',eligibility:'Tech-based innovations',link:'https://industries.bihar.gov.in/',applyLink:'https://industries.bihar.gov.in/'},
      
      // Chhattisgarh
      {_id:'17',name:'CG Startup Policy',desc:'Startup ecosystem development fund',state:'chhattisgarh',stage:'early',sector:'all',eligibility:'CG based startups',link:'https://investchhattisgarh.in/',applyLink:'https://investchhattisgarh.in/'},
      
      // Delhi
      {_id:'18',name:'Delhi Startup Policy',desc:'Comprehensive startup support up to ₹50L',state:'delhi',stage:'early',sector:'all',eligibility:'Delhi registered startups',link:'https://it.delhi.gov.in/',applyLink:'https://it.delhi.gov.in/'},
      {_id:'19',name:'Delhi Innovation Fund',desc:'Innovation and technology development',state:'delhi',stage:'idea',sector:'tech',eligibility:'Innovative tech solutions',link:'https://dsidc.org/',applyLink:'https://dsidc.org/'},
      
      // Goa
      {_id:'20',name:'Goa Startup Policy',desc:'State startup promotion scheme',state:'goa',stage:'early',sector:'all',eligibility:'Goa based enterprises',link:'https://www.goa.gov.in/',applyLink:'https://www.goa.gov.in/'},
      
      // Gujarat
      {_id:'21',name:'Gujarat Startup Policy',desc:'Comprehensive startup ecosystem support up to ₹1Cr',state:'gujarat',stage:'early',sector:'all',eligibility:'Gujarat registered startups',link:'https://www.gujaratindustry.gov.in/',applyLink:'https://www.gujaratindustry.gov.in/'},
      {_id:'22',name:'iCreate Gujarat',desc:'Innovation and incubation support',state:'gujarat',stage:'idea',sector:'tech',eligibility:'Technology innovations',link:'https://www.icreate.org.in/',applyLink:'https://www.icreate.org.in/'},
      {_id:'23',name:'Gujarat Agri Innovation',desc:'Agriculture technology funding',state:'gujarat',stage:'early',sector:'agri',eligibility:'Agri-tech startups',link:'https://agri.gujarat.gov.in/',applyLink:'https://agri.gujarat.gov.in/'},
      
      // Haryana
      {_id:'24',name:'Haryana Startup Policy',desc:'State startup fund up to ₹40L',state:'haryana',stage:'early',sector:'all',eligibility:'Haryana based startups',link:'https://www.haryanaindustries.gov.in/',applyLink:'https://www.haryanaindustries.gov.in/'},
      {_id:'25',name:'Haryana Agri Fund',desc:'Agricultural innovation support',state:'haryana',stage:'early',sector:'agri',eligibility:'Agriculture startups',link:'https://agriharyana.gov.in/',applyLink:'https://agriharyana.gov.in/'},
      
      // Himachal Pradesh
      {_id:'26',name:'HP Startup Policy',desc:'Hill state startup promotion',state:'himachalpradesh',stage:'early',sector:'all',eligibility:'HP registered entities',link:'https://himachalindustries.nic.in/',applyLink:'https://himachalindustries.nic.in/'},
      
      // Jharkhand
      {_id:'27',name:'Jharkhand Startup Policy',desc:'State innovation fund',state:'jharkhand',stage:'early',sector:'all',eligibility:'Jharkhand based startups',link:'https://jharkhandi.jharkhand.gov.in/',applyLink:'https://jharkhandi.jharkhand.gov.in/'},
      
      // Karnataka
      {_id:'28',name:'Karnataka Startup Cell',desc:'Comprehensive startup support up to ₹1Cr',state:'karnataka',stage:'early',sector:'all',eligibility:'Karnataka-based startups',link:'https://ksteps.in/',applyLink:'https://ksteps.in/'},
      {_id:'29',name:'Elevate Program Karnataka',desc:'Deep-tech startup support up to ₹50L',state:'karnataka',stage:'early',sector:'tech',eligibility:'Deep-tech innovations',link:'https://www.elevate.karnataka.gov.in/',applyLink:'https://www.elevate.karnataka.gov.in/'},
      {_id:'30',name:'Karnataka Agri Innovation',desc:'Agriculture technology funding',state:'karnataka',stage:'early',sector:'agri',eligibility:'Agri-tech startups',link:'https://raitamitra.karnataka.gov.in/',applyLink:'https://raitamitra.karnataka.gov.in/'},
      {_id:'31',name:'Karnataka Health Innovation',desc:'Healthcare startup support',state:'karnataka',stage:'early',sector:'health',eligibility:'Healthcare innovations',link:'https://karnataka.gov.in/',applyLink:'https://karnataka.gov.in/'},
      
      // Kerala
      {_id:'32',name:'Kerala Startup Mission',desc:'State startup ecosystem development up to ₹35L',state:'kerala',stage:'early',sector:'all',eligibility:'Kerala registered startups',link:'https://startupmission.kerala.gov.in/',applyLink:'https://startupmission.kerala.gov.in/'},
      {_id:'33',name:'Kerala Tech Innovation',desc:'Technology startup support',state:'kerala',stage:'idea',sector:'tech',eligibility:'Tech-based solutions',link:'https://www.technopark.org/',applyLink:'https://www.technopark.org/'},
      
      // Madhya Pradesh
      {_id:'34',name:'MP Startup Policy',desc:'State innovation fund up to ₹30L',state:'madhyapradesh',stage:'early',sector:'all',eligibility:'MP registered entities',link:'https://mpmsme.gov.in/',applyLink:'https://mpmsme.gov.in/'},
      {_id:'35',name:'MP Agri Innovation',desc:'Agriculture startup support',state:'madhyapradesh',stage:'early',sector:'agri',eligibility:'Agricultural innovations',link:'https://mpkrishi.mp.gov.in/',applyLink:'https://mpkrishi.mp.gov.in/'},
      
      // Maharashtra
      {_id:'36',name:'Maharashtra Innovation Society',desc:'Comprehensive startup ecosystem support up to ₹25L',state:'maharashtra',stage:'early',sector:'tech',eligibility:'Maharashtra registered startups',link:'https://msinnovation.maharashtra.gov.in/',applyLink:'https://msinnovation.maharashtra.gov.in/'},
      {_id:'37',name:'Maharashtra Agri Business',desc:'Agriculture technology incubation up to ₹15L',state:'maharashtra',stage:'early',sector:'agri',eligibility:'Agri-tech ventures',link:'https://krishi.maharashtra.gov.in/',applyLink:'https://krishi.maharashtra.gov.in/'},
      {_id:'38',name:'Maharashtra Health Innovation',desc:'Healthcare startup support',state:'maharashtra',stage:'early',sector:'health',eligibility:'Healthcare startups',link:'https://www.maharashtra.gov.in/',applyLink:'https://www.maharashtra.gov.in/'},
      
      // Manipur
      {_id:'39',name:'Manipur Startup Policy',desc:'Northeast startup promotion',state:'manipur',stage:'early',sector:'all',eligibility:'Manipur based startups',link:'https://manipur.gov.in/',applyLink:'https://manipur.gov.in/'},
      
      // Meghalaya
      {_id:'40',name:'Meghalaya Innovation Fund',desc:'State startup support',state:'meghalaya',stage:'early',sector:'all',eligibility:'Meghalaya registered entities',link:'https://meghalaya.gov.in/',applyLink:'https://meghalaya.gov.in/'},
      
      // Mizoram
      {_id:'41',name:'Mizoram Startup Scheme',desc:'Northeast innovation support',state:'mizoram',stage:'early',sector:'all',eligibility:'Mizoram based startups',link:'https://mizoram.gov.in/',applyLink:'https://mizoram.gov.in/'},
      
      // Nagaland
      {_id:'42',name:'Nagaland Innovation Policy',desc:'Tribal area startup support',state:'nagaland',stage:'early',sector:'all',eligibility:'Nagaland entrepreneurs',link:'https://nagaland.gov.in/',applyLink:'https://nagaland.gov.in/'},
      
      // Odisha
      {_id:'43',name:'Odisha Startup Policy',desc:'State innovation ecosystem up to ₹20L',state:'odisha',stage:'early',sector:'all',eligibility:'Odisha registered startups',link:'https://investodisha.gov.in/',applyLink:'https://investodisha.gov.in/'},
      {_id:'44',name:'Odisha Agri Innovation',desc:'Agriculture technology support',state:'odisha',stage:'early',sector:'agri',eligibility:'Agri-tech startups',link:'https://agri.odisha.gov.in/',applyLink:'https://agri.odisha.gov.in/'},
      
      // Punjab
      {_id:'45',name:'Punjab Startup Policy',desc:'State startup fund up to ₹25L',state:'punjab',stage:'early',sector:'all',eligibility:'Punjab registered entities',link:'https://investpunjab.gov.in/',applyLink:'https://investpunjab.gov.in/'},
      {_id:'46',name:'Punjab Agri Innovation',desc:'Agriculture startup support',state:'punjab',stage:'early',sector:'agri',eligibility:'Agricultural innovations',link:'https://agri.punjab.gov.in/',applyLink:'https://agri.punjab.gov.in/'},
      
      // Rajasthan
      {_id:'47',name:'Rajasthan Startup Policy',desc:'Desert state innovation fund up to ₹30L',state:'rajasthan',stage:'early',sector:'all',eligibility:'Rajasthan based startups',link:'https://invest.rajasthan.gov.in/',applyLink:'https://invest.rajasthan.gov.in/'},
      {_id:'48',name:'Rajasthan Tech Innovation',desc:'Technology startup support',state:'rajasthan',stage:'idea',sector:'tech',eligibility:'Tech innovations',link:'https://riico.rajasthan.gov.in/',applyLink:'https://riico.rajasthan.gov.in/'},
      
      // Sikkim
      {_id:'49',name:'Sikkim Startup Scheme',desc:'Hill state innovation support',state:'sikkim',stage:'early',sector:'all',eligibility:'Sikkim entrepreneurs',link:'https://sikkim.gov.in/',applyLink:'https://sikkim.gov.in/'},
      
      // Tamil Nadu
      {_id:'50',name:'Tamil Nadu Startup Policy',desc:'Comprehensive startup support up to ₹35L',state:'tamilnadu',stage:'early',sector:'all',eligibility:'Tamil Nadu registered startups',link:'https://www.startuptn.in/',applyLink:'https://www.startuptn.in/'},
      {_id:'51',name:'TIDCO Startup Fund',desc:'State government fund up to ₹2Cr',state:'tamilnadu',stage:'growth',sector:'all',eligibility:'Proven business model',link:'https://www.tidco.com/',applyLink:'https://www.tidco.com/'},
      {_id:'52',name:'TN Agri Innovation',desc:'Agriculture technology funding',state:'tamilnadu',stage:'early',sector:'agri',eligibility:'Agri-tech startups',link:'https://www.tn.gov.in/',applyLink:'https://www.tn.gov.in/'},
      {_id:'53',name:'TN Health Innovation',desc:'Healthcare startup support',state:'tamilnadu',stage:'early',sector:'health',eligibility:'Healthcare innovations',link:'https://www.tn.gov.in/',applyLink:'https://www.tn.gov.in/'},
      
      // Telangana
      {_id:'54',name:'T-Hub Telangana',desc:'Innovation hub with funding up to ₹50L',state:'telangana',stage:'early',sector:'tech',eligibility:'Tech startups',link:'https://t-hub.co/',applyLink:'https://t-hub.co/'},
      {_id:'55',name:'Telangana Startup Policy',desc:'State innovation ecosystem',state:'telangana',stage:'early',sector:'all',eligibility:'Telangana based startups',link:'https://www.telangana.gov.in/',applyLink:'https://www.telangana.gov.in/'},
      
      // Tripura
      {_id:'56',name:'Tripura Innovation Fund',desc:'Northeast startup support',state:'tripura',stage:'early',sector:'all',eligibility:'Tripura entrepreneurs',link:'https://tripura.gov.in/',applyLink:'https://tripura.gov.in/'},
      
      // Uttar Pradesh
      {_id:'57',name:'UP Startup Policy',desc:'State startup fund up to ₹25L',state:'up',stage:'early',sector:'all',eligibility:'UP registered startups',link:'https://invest.up.gov.in/',applyLink:'https://invest.up.gov.in/'},
      {_id:'58',name:'UP Agri Business Policy',desc:'Agriculture and food processing support up to ₹20L',state:'up',stage:'early',sector:'agri',eligibility:'Agri-tech startups in UP',link:'https://upagripardarshi.gov.in/',applyLink:'https://upagripardarshi.gov.in/'},
      {_id:'59',name:'UP Tech Innovation',desc:'Technology startup support',state:'up',stage:'idea',sector:'tech',eligibility:'Tech-based innovations',link:'https://upsida.gov.in/',applyLink:'https://upsida.gov.in/'},
      
      // Uttarakhand
      {_id:'60',name:'Uttarakhand Startup Policy',desc:'Hill state innovation fund',state:'uttarakhand',stage:'early',sector:'all',eligibility:'Uttarakhand based startups',link:'https://uk.gov.in/',applyLink:'https://uk.gov.in/'},
      
      // West Bengal
      {_id:'61',name:'West Bengal Startup Policy',desc:'State innovation ecosystem up to ₹30L',state:'westbengal',stage:'early',sector:'all',eligibility:'WB registered startups',link:'https://wb.gov.in/',applyLink:'https://wb.gov.in/'},
      {_id:'62',name:'WB Tech Innovation',desc:'Technology startup support',state:'westbengal',stage:'idea',sector:'tech',eligibility:'Tech innovations',link:'https://wbidc.com/',applyLink:'https://wbidc.com/'}
    ];
    
    // Auto-update schemes on page load
    updateSchemesDatabase();
    
    // Global funding schemes data
    let globalSchemes = JSON.parse(localStorage.getItem('globalSchemes')) || [
      {_id:'g1',name:'Y Combinator',desc:'World\'s most successful startup accelerator - $500K funding',stage:'early',sector:'all',eligibility:'Early-stage startups worldwide',link:'https://www.ycombinator.com/apply',applyLink:'https://www.ycombinator.com/apply',funding:'$500K',location:'USA'},
      {_id:'g2',name:'Techstars Global Accelerator',desc:'Mentorship-driven accelerator with $120K investment',stage:'early',sector:'tech',eligibility:'Tech startups globally',link:'https://www.techstars.com/apply',applyLink:'https://www.techstars.com/apply',funding:'$120K',location:'Global'},
      {_id:'g3',name:'500 Global Accelerator',desc:'Early-stage VC with $250K investment + mentorship',stage:'early',sector:'all',eligibility:'Seed-stage startups',link:'https://500.co/accelerators',applyLink:'https://500.co/accelerators',funding:'$250K',location:'Global'},
      {_id:'g4',name:'Plug and Play Accelerator',desc:'Corporate innovation platform with global reach',stage:'early',sector:'all',eligibility:'B2B startups',link:'https://www.plugandplaytechcenter.com/apply',applyLink:'https://www.plugandplaytechcenter.com/apply',funding:'Varies',location:'Global'},
      {_id:'g5',name:'Antler Global',desc:'Early-stage VC building startups from day zero',stage:'idea',sector:'all',eligibility:'Entrepreneurs globally',link:'https://www.antler.co/apply',applyLink:'https://www.antler.co/apply',funding:'$250K',location:'Global'},
      {_id:'g6',name:'SOSV Accelerator',desc:'Multi-stage VC with $250K+ investments',stage:'early',sector:'all',eligibility:'Deep tech and life sciences',link:'https://sosv.com/apply',applyLink:'https://sosv.com/apply',funding:'$250K+',location:'Global'},
      {_id:'g7',name:'Entrepreneur First',desc:'Pre-seed program for ambitious individuals',stage:'idea',sector:'tech',eligibility:'Technical talent globally',link:'https://www.joinef.com/apply',applyLink:'https://www.joinef.com/apply',funding:'$200K',location:'Global'},
      {_id:'g8',name:'Seedcamp',desc:'European seed fund investing $250K in early-stage',stage:'early',sector:'tech',eligibility:'European tech startups',link:'https://seedcamp.com/apply',applyLink:'https://seedcamp.com/apply',funding:'$250K',location:'Europe'},
      {_id:'g9',name:'Google for Startups',desc:'Google\'s startup accelerator with $100K+ funding',stage:'early',sector:'tech',eligibility:'AI/ML focused startups',link:'https://startup.google.com/accelerator',applyLink:'https://startup.google.com/accelerator',funding:'$100K+',location:'Global'},
      {_id:'g10',name:'Microsoft for Startups',desc:'Microsoft accelerator with $120K Azure credits',stage:'early',sector:'tech',eligibility:'B2B SaaS startups',link:'https://www.microsoft.com/startups/apply',applyLink:'https://www.microsoft.com/startups/apply',funding:'$120K Credits',location:'Global'},
      {_id:'g11',name:'AWS Activate',desc:'Amazon startup program with $100K+ AWS credits',stage:'early',sector:'tech',eligibility:'Cloud-based startups',link:'https://aws.amazon.com/activate/apply',applyLink:'https://aws.amazon.com/activate/apply',funding:'$100K+ Credits',location:'Global'},
      {_id:'g12',name:'NVIDIA Inception',desc:'AI startup accelerator with GPU credits and support',stage:'early',sector:'tech',eligibility:'AI/ML startups',link:'https://www.nvidia.com/en-us/startups/apply',applyLink:'https://www.nvidia.com/en-us/startups/apply',funding:'GPU Credits',location:'Global'},
      {_id:'g13',name:'Stripe Atlas',desc:'Startup incorporation and banking with funding access',stage:'idea',sector:'fintech',eligibility:'Fintech startups globally',link:'https://stripe.com/atlas/apply',applyLink:'https://stripe.com/atlas/apply',funding:'Varies',location:'Global'},
      {_id:'g14',name:'Shopify Partners Fund',desc:'E-commerce startup funding up to $1M',stage:'early',sector:'retail',eligibility:'E-commerce startups',link:'https://www.shopify.com/partners/fund/apply',applyLink:'https://www.shopify.com/partners/fund/apply',funding:'Up to $1M',location:'Global'},
      {_id:'g15',name:'Rocket Internet',desc:'Global startup incubator and venture builder',stage:'early',sector:'all',eligibility:'Scalable business models',link:'https://www.rocket-internet.com/apply',applyLink:'https://www.rocket-internet.com/apply',funding:'Varies',location:'Global'}
    ];
    
    let investors = JSON.parse(localStorage.getItem('activeInvestors')) || [
      {_id:'1',name:'Indian Angel Network',desc:'Angels and syndicates investing in early-stage across sectors',type:'angel',website:'https://www.indianangelnetwork.com',applyLink:'https://www.indianangelnetwork.com/startup-application'},
      {_id:'2',name:'Sequoia Capital India',desc:'Leading VC firm investing in technology startups',type:'vc',website:'https://www.sequoiacap.com/india',applyLink:'https://www.sequoiacap.com/india/companies/'},
      {_id:'3',name:'Accel Partners',desc:'Global VC firm with strong Indian presence',type:'vc',website:'https://www.accel.com',applyLink:'https://www.accel.com/companies/'},
      {_id:'4',name:'T-Hub',desc:'Innovation hub and ecosystem enabler',type:'incubator',website:'https://t-hub.co',applyLink:'https://t-hub.co/startup-application/'},
      {_id:'5',name:'Blume Ventures',desc:'Early-stage VC fund investing in Indian startups',type:'vc',website:'https://blume.vc',applyLink:'https://blume.vc/portfolio/'},
      {_id:'6',name:'Kalaari Capital',desc:'Early-stage venture capital firm',type:'vc',website:'https://kalaari.com',applyLink:'https://kalaari.com/portfolio/'}
    ];
    
    // Auto-update investors on page load
    updateInvestorsDatabase();

    // Automatic Scheme Management System
    function updateSchemesDatabase() {
      const activeSchemeIds = ['1', '2', '3', '4', '5', '6', '8', '9', '10', '28', '29', '32', '36', '50', '54'];
      const newActiveSchemes = [
        // Indian Schemes
        {_id:'63',name:'PM MUDRA Plus',desc:'Enhanced micro-finance scheme up to ₹20L for women entrepreneurs',state:'central',stage:'early',sector:'all',eligibility:'Women-led enterprises',link:'https://www.mudra.org.in/plus',applyLink:'https://www.mudra.org.in/plus'},
        {_id:'64',name:'Digital India Startup Fund 2025',desc:'New ₹1000Cr fund for digital innovation startups',state:'central',stage:'early',sector:'tech',eligibility:'DPIIT recognized tech startups',link:'https://digitalindia.gov.in/startup-fund',applyLink:'https://digitalindia.gov.in/startup-fund'},
        {_id:'65',name:'Green Energy Innovation Scheme',desc:'Clean energy startup support up to ₹75L',state:'central',stage:'early',sector:'energy',eligibility:'Renewable energy startups',link:'https://mnre.gov.in/innovation',applyLink:'https://mnre.gov.in/innovation'},
        
        // Global Funding Schemes
        {_id:'66',name:'Y Combinator',desc:'World\'s most successful startup accelerator - $500K funding',state:'global',stage:'early',sector:'all',eligibility:'Early-stage startups worldwide',link:'https://www.ycombinator.com/apply',applyLink:'https://www.ycombinator.com/apply'},
        {_id:'67',name:'Techstars Global Accelerator',desc:'Mentorship-driven accelerator with $120K investment',state:'global',stage:'early',sector:'tech',eligibility:'Tech startups globally',link:'https://www.techstars.com/apply',applyLink:'https://www.techstars.com/apply'},
        {_id:'68',name:'500 Global Accelerator',desc:'Early-stage VC with $250K investment + mentorship',state:'global',stage:'early',sector:'all',eligibility:'Seed-stage startups',link:'https://500.co/accelerators',applyLink:'https://500.co/accelerators'},
        {_id:'69',name:'Plug and Play Accelerator',desc:'Corporate innovation platform with global reach',state:'global',stage:'early',sector:'all',eligibility:'B2B startups',link:'https://www.plugandplaytechcenter.com/apply',applyLink:'https://www.plugandplaytechcenter.com/apply'},
        {_id:'70',name:'Antler Global',desc:'Early-stage VC building startups from day zero',state:'global',stage:'idea',sector:'all',eligibility:'Entrepreneurs globally',link:'https://www.antler.co/apply',applyLink:'https://www.antler.co/apply'},
        {_id:'71',name:'SOSV Accelerator',desc:'Multi-stage VC with $250K+ investments',state:'global',stage:'early',sector:'all',eligibility:'Deep tech and life sciences',link:'https://sosv.com/apply',applyLink:'https://sosv.com/apply'},
        {_id:'72',name:'Entrepreneur First',desc:'Pre-seed program for ambitious individuals',state:'global',stage:'idea',sector:'tech',eligibility:'Technical talent globally',link:'https://www.joinef.com/apply',applyLink:'https://www.joinef.com/apply'},
        {_id:'73',name:'Seedcamp',desc:'European seed fund investing $250K in early-stage',state:'global',stage:'early',sector:'tech',eligibility:'European tech startups',link:'https://seedcamp.com/apply',applyLink:'https://seedcamp.com/apply'},
        {_id:'74',name:'Rocket Internet',desc:'Global startup incubator and venture builder',state:'global',stage:'early',sector:'all',eligibility:'Scalable business models',link:'https://www.rocket-internet.com/apply',applyLink:'https://www.rocket-internet.com/apply'},
        {_id:'75',name:'Google for Startups',desc:'Google\'s startup accelerator with $100K+ funding',state:'global',stage:'early',sector:'tech',eligibility:'AI/ML focused startups',link:'https://startup.google.com/accelerator',applyLink:'https://startup.google.com/accelerator'},
        {_id:'76',name:'Microsoft for Startups',desc:'Microsoft accelerator with $120K Azure credits',state:'global',stage:'early',sector:'tech',eligibility:'B2B SaaS startups',link:'https://www.microsoft.com/startups/apply',applyLink:'https://www.microsoft.com/startups/apply'},
        {_id:'77',name:'AWS Activate',desc:'Amazon startup program with $100K+ AWS credits',state:'global',stage:'early',sector:'tech',eligibility:'Cloud-based startups',link:'https://aws.amazon.com/activate/apply',applyLink:'https://aws.amazon.com/activate/apply'},
        {_id:'78',name:'NVIDIA Inception',desc:'AI startup accelerator with GPU credits and support',state:'global',stage:'early',sector:'tech',eligibility:'AI/ML startups',link:'https://www.nvidia.com/en-us/startups/apply',applyLink:'https://www.nvidia.com/en-us/startups/apply'},
        {_id:'79',name:'Stripe Atlas',desc:'Startup incorporation and banking with funding access',state:'global',stage:'idea',sector:'fintech',eligibility:'Fintech startups globally',link:'https://stripe.com/atlas/apply',applyLink:'https://stripe.com/atlas/apply'},
        {_id:'80',name:'Shopify Partners Fund',desc:'E-commerce startup funding up to $1M',state:'global',stage:'early',sector:'retail',eligibility:'E-commerce startups',link:'https://www.shopify.com/partners/fund/apply',applyLink:'https://www.shopify.com/partners/fund/apply'}
      ];
      
      // Filter only active schemes
      const filteredSchemes = schemes.filter(s => activeSchemeIds.includes(s._id));
      
      // Add new schemes if not already present
      newActiveSchemes.forEach(newScheme => {
        if (!filteredSchemes.find(s => s._id === newScheme._id)) {
          filteredSchemes.push(newScheme);
          activeSchemeIds.push(newScheme._id);
        }
      });
      
      schemes = filteredSchemes;
      localStorage.setItem('activeSchemes', JSON.stringify(schemes));
      localStorage.setItem('lastSchemeUpdate', new Date().toISOString());
      
      console.log(`🔄 Schemes updated: ${schemes.length} active schemes loaded`);
    }
    
    function updateInvestorsDatabase() {
      const activeInvestorIds = ['1', '2', '3', '4', '5', '6'];
      const newActiveInvestors = [
        {_id:'7',name:'Lightspeed India',desc:'Leading VC firm investing in consumer and enterprise startups',type:'vc',website:'https://lightspeedindia.com',applyLink:'https://lightspeedindia.com/apply'},
        {_id:'8',name:'Matrix Partners India',desc:'Early-stage VC focusing on fintech and SaaS',type:'vc',website:'https://matrixpartners.in',applyLink:'https://matrixpartners.in/portfolio'}
      ];
      
      // Filter only active investors
      const filteredInvestors = investors.filter(i => activeInvestorIds.includes(i._id));
      
      // Add new investors if not already present
      newActiveInvestors.forEach(newInvestor => {
        if (!filteredInvestors.find(i => i._id === newInvestor._id)) {
          filteredInvestors.push(newInvestor);
          activeInvestorIds.push(newInvestor._id);
        }
      });
      
      investors = filteredInvestors;
      localStorage.setItem('activeInvestors', JSON.stringify(investors));
      localStorage.setItem('lastInvestorUpdate', new Date().toISOString());
      
      console.log(`🔄 Investors updated: ${investors.length} active investors loaded`);
    }
    
    // Auto-refresh schemes and investors every 24 hours
    function autoRefreshDatabase() {
      const lastSchemeUpdate = localStorage.getItem('lastSchemeUpdate');
      const lastInvestorUpdate = localStorage.getItem('lastInvestorUpdate');
      const now = new Date();
      
      // Check if 24 hours have passed
      if (!lastSchemeUpdate || (now - new Date(lastSchemeUpdate)) > 86400000) {
        updateSchemesDatabase();
        showInAppNotification('🔄 Schemes database updated with latest active schemes');
      }
      
      if (!lastInvestorUpdate || (now - new Date(lastInvestorUpdate)) > 86400000) {
        updateInvestorsDatabase();
        showInAppNotification('🔄 Investors database updated with latest active investors');
      }
    }
    
    // Manual refresh function
    function manualRefreshDatabase() {
      updateSchemesDatabase();
      updateInvestorsDatabase();
      fetchSchemes();
      fetchInvestors();
      showInAppNotification('✅ Database refreshed successfully! Inactive schemes removed, new schemes added.');
    }
    
    // Check for scheme status changes
    function checkSchemeStatusChanges() {
      const inactiveSchemes = JSON.parse(localStorage.getItem('removedSchemes') || '[]');
      const removedCount = inactiveSchemes.length;
      const activeCount = schemes.length;
      
      return {
        activeSchemes: activeCount,
        removedSchemes: removedCount,
        lastUpdate: localStorage.getItem('lastSchemeUpdate')
      };
    }

    // Utility function to escape HTML for safety
    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m];
      });
    }

    // --- Render Functions ---
    function renderGlobalGrid(globalSchemes){
      const grid = document.getElementById('globalGrid');
      grid.innerHTML = '';
      if (globalSchemes && globalSchemes.length > 0) {
        globalSchemes.forEach(s => {
          const el = document.createElement('div');
          el.className = 'card';
          el.innerHTML = `
            <div style='display:flex;justify-content:space-between;align-items:start;margin-bottom:8px'>
              <h3 style='margin:0;flex:1'>${escapeHtml(s.name)}</h3>
              <span class='tag' style='background:#06b6d4;color:#fff;font-size:0.75rem'>GLOBAL</span>
            </div>
            <div class="meta">${escapeHtml(s.desc)}</div>
            <div style='margin:8px 0;font-size:0.85rem;color:var(--muted)'>
              <div>💰 Funding: ${s.funding}</div>
              <div>🌍 Location: ${s.location}</div>
            </div>
            <div class="actions">
              <button class="btn primary" onclick="openGlobalSchemeDetails('${s._id}')">Details</button>
              <a class="btn ghost" href="${s.applyLink}" target="_blank" rel="noopener">Apply Direct</a>
            </div>`;
          grid.appendChild(el);
        });
      } else {
        grid.innerHTML = '<p class="muted" style="text-align:center;grid-column:1/-1;">No global funding schemes found matching your criteria.</p>';
      }
    }
    
    function renderGovGrid(schemes){
      const grid = document.getElementById('govGrid');
      grid.innerHTML = ''; // Clear existing content
      if (schemes && schemes.length > 0) {
        schemes.forEach(s => {
          const el = document.createElement('div');
          el.className = 'card';
          const isGlobal = s.state === 'global';
          const stateLabel = isGlobal ? 'GLOBAL' : s.state.toUpperCase();
          const stateBadge = isGlobal ? 'background:#06b6d4;color:#fff' : 'background:rgba(255,255,255,0.02);color:var(--muted)';
          
          el.innerHTML = `
            <div style='display:flex;justify-content:space-between;align-items:start;margin-bottom:8px'>
              <h3 style='margin:0;flex:1'>${escapeHtml(s.name)}</h3>
              <span class='tag' style='${stateBadge};font-size:0.75rem'>${stateLabel}</span>
            </div>
            <div class="meta">${escapeHtml(s.desc)}</div>
            <div class="actions">
              <button class="btn primary" onclick="openSchemeDetails('${s._id}')">Details</button>
              ${isGlobal ? 
                `<a class="btn ghost" href="${s.applyLink}" target="_blank" rel="noopener">Apply Direct</a>` :
                `<button class="btn ghost" onclick="startApply('${s._id}')">Apply</button>`
              }
            </div>`;
          grid.appendChild(el);
        });
      } else {
        grid.innerHTML = '<p class="muted" style="text-align:center;grid-column:1/-1;">No government schemes found matching your criteria.</p>';
      }
    }

    function renderInvestorsFromList(investors){ // Renamed to avoid conflict with fetchInvestors
      const grid = document.getElementById('investorGrid');
      grid.innerHTML = ''; // Clear existing content
      if (investors && investors.length > 0) {
        investors.forEach(inv => {
          const el = document.createElement('div');
          el.className = 'card';
          el.innerHTML = `<h3>${escapeHtml(inv.name)}</h3><div class="meta">${escapeHtml(inv.desc)}</div>
            <div class="actions"><button class="btn primary" onclick="openInvestor('${inv._id}')">View</button><button class="btn ghost" onclick="openInvestorApply('${inv._id}')">Apply</button></div>`;
          grid.appendChild(el);
        });
      } else {
        grid.innerHTML = '<p class="muted" style="text-align:center;grid-column:1/-1;">No private investors found matching your criteria.</p>';
      }
    }

    // --- Fetch Data (Static) ---
    function fetchGlobalSchemes(filters = {}) {
      let filtered = globalSchemes.filter(s => {
        if (filters.stage && filters.stage !== 'all' && s.stage !== filters.stage) return false;
        if (filters.sector && filters.sector !== 'all' && s.sector !== filters.sector) return false;
        if (filters.q && !s.name.toLowerCase().includes(filters.q.toLowerCase()) && !s.desc.toLowerCase().includes(filters.q.toLowerCase())) return false;
        return true;
      });
      renderGlobalGrid(filtered);
    }
    
    function fetchSchemes(filters = {}) {
      let filtered = schemes.filter(s => {
        if (filters.state && filters.state !== 'all' && s.state !== filters.state) return false;
        if (filters.stage && filters.stage !== 'all' && s.stage !== filters.stage) return false;
        if (filters.sector && filters.sector !== 'all' && s.sector !== filters.sector) return false;
        if (filters.q && !s.name.toLowerCase().includes(filters.q.toLowerCase()) && !s.desc.toLowerCase().includes(filters.q.toLowerCase())) return false;
        return true;
      });
      renderGovGrid(filtered);
      document.getElementById('schemeCount').innerText = filtered.length;
    }

    function fetchInvestors() {
      const q = document.getElementById('globalSearch').value.trim();
      let filtered = investors.filter(i => {
        if (q && !i.name.toLowerCase().includes(q.toLowerCase()) && !i.desc.toLowerCase().includes(q.toLowerCase())) return false;
        return true;
      });
      renderInvestorsFromList(filtered);
      document.getElementById('vcCount').innerText = filtered.length;
    }

    // --- Filters & Search ---
    function applyGlobalFilters(){
      const stage = document.getElementById('globalStageFilter').value;
      const sector = document.getElementById('globalSectorFilter').value;
      fetchGlobalSchemes({ stage, sector });
    }
    
    function applyFilters(){
      const state = document.getElementById('stateFilter').value;
      const stage = document.getElementById('stageFilter').value;
      const sector = document.getElementById('sectorFilter').value;
      fetchSchemes({ state, stage, sector });
    }
    


    function liveSearch(){
      const q = document.getElementById('globalSearch').value.trim();
      // Pass the search query to both scheme and investor fetching functions
      fetchSchemes({ q });
      fetchInvestors(); // fetchInvestors already includes 'q' from globalSearch
    }

    // --- Modal Helpers ---
    function openModal(name){
      document.getElementById('modal').style.display='flex';
      document.getElementById('modalTitle').innerText = name === 'signup' ? 'Create an account' : name === 'applyFull' ? 'Full application' : name;
      const body = document.getElementById('modalBody');
      body.innerHTML = ''; // Clear previous modal content

      if(name === 'login'){
        body.innerHTML = `<form onsubmit="handleLogin(event)">
          <label for='login_email'>Email</label>
          <input required id='login_email' type='email' placeholder='your@email.com'/>
          <label for='login_password'>Password</label>
          <input required id='login_password' type='password' placeholder='Enter your password'/>
          <div style='margin-top:12px'>
            <button class='btn primary'>Login</button>
            <button type='button' class='btn ghost' onclick='openModal("signup")' style='margin-left:8px'>Create Account</button>
          </div>
          <div style='margin-top:8px;text-align:center'>
            <a href='#' onclick='forgotPassword()' style='color:var(--accent);font-size:0.9rem'>Forgot Password?</a>
          </div>
        </form>`;
      } else if(name === 'signup'){
        body.innerHTML = `<form onsubmit="handleSignup(event)">
          <label for='su_name'>Full Name</label>
          <input required id='su_name' type='text' placeholder='Your full name'/>
          <label for='su_email'>Email</label>
          <input required id='su_email' type='email' placeholder='your@email.com'/>
          <label for='su_password'>Password</label>
          <input required id='su_password' type='password' placeholder='Minimum 6 characters'/>
          <label for='su_confirm'>Confirm Password</label>
          <input required id='su_confirm' type='password' placeholder='Confirm your password'/>
          <label for='su_type'>Account Type</label>
          <select id='su_type' required>
            <option value=''>Select Type</option>
            <option value='founder'>Startup Founder</option>
            <option value='investor'>Investor</option>
            <option value='advisor'>Advisor/Mentor</option>
            <option value='other'>Other</option>
          </select>
          <div style='margin-top:12px'>
            <label style='display:flex;align-items:center'>
              <input type='checkbox' required style='margin-right:8px'/>
              I agree to Terms & Conditions and Privacy Policy
            </label>
          </div>
          <div style='margin-top:12px'>
            <button class='btn primary'>Create Account</button>
            <button type='button' class='btn ghost' onclick='openModal("login")' style='margin-left:8px'>Already have account?</button>
          </div>
        </form>`;
      } else if(name === 'applyFull'){
        body.innerHTML = `<form onsubmit="handleFullApply(event)">
          <label for='fa_name'>Startup name</label><input id='fa_name' required type='text'/>
          <label for='fa_email'>Contact email</label><input id='fa_email' required type='email'/>
          <label for='fa_sector'>Sector</label>
          <select id='fa_sector'>
            <option value="tech">Tech</option>
            <option value="agri">Agritech</option>
            <option value="health">Healthcare</option>
            <option value="energy">Energy</option>
            <option value="all">All</option>
          </select>
          <label for='fa_stage'>Stage</label>
          <select id='fa_stage'>
            <option value="idea">Idea</option>
            <option value="early">Early</option>
            <option value="growth">Growth</option>
          </select>
          <label for='fa_summary'>One-line summary</label><input id='fa_summary' type='text' placeholder='Short description (20 words)'/>
          <label for='fa_entity'>Registered entity (eg Pvt Ltd)</label><input id='fa_entity' type='text'/>
          <label for='fa_deck'>Attach deck (URL)</label><input id='fa_deck' type='text' placeholder='Drive/URL'/>
          <label for='fa_desc'>Describe product</label><textarea id='fa_desc'></textarea>
          <div style='margin-top:12px'><button class='btn primary'>Submit application</button></div>
        </form>`;
      }
      else { body.innerHTML = '<div class="muted">Loading...</div>'; }
    }
    function closeModal(){ document.getElementById('modal').style.display='none'; }

    function openSchemeDetails(schemeId){
      const scheme = schemes.find(s => s._id === schemeId);
      if (scheme) {
        openModal('Scheme Details');
        document.getElementById('modalTitle').innerText = scheme.name;
        const eligibilityDetails = getSchemeEligibility(scheme._id);
        document.getElementById('modalBody').innerHTML = `<h4>Description</h4><p class='muted'>${escapeHtml(scheme.desc)}</p>
          <div style='text-align:center;background:#f8f9fa;padding:20px;border-radius:10px;margin:15px 0'>
            <h4 style='margin:0 0 15px 0;color:#333'>📋 Eligibility Criteria</h4>
            <div style='text-align:left;max-width:600px;margin:0 auto'>
              ${eligibilityDetails}
            </div>
          </div>
          <div style='margin-top:15px;text-align:center'>
            <button class='btn primary' onclick='checkEligibility("${scheme._id}")'>Check My Eligibility</button> 
            ${scheme.state === 'global' ? 
              `<a class='btn primary' href='${scheme.applyLink}' target='_blank' rel='noopener' style='margin-left:8px'>Apply Directly</a>` : 
              `<button class='btn ghost' onclick='openDirectApply("${scheme._id}")'>Apply Now</button>`
            }
            <a class='btn ghost' href='${scheme.link}' target='_blank' rel='noopener'>Official Portal</a>
          </div>`;
      }
    }

    function openSchemeDetailsByName(schemeName) {
      const scheme = schemes.find(s => s.name.includes(schemeName));
      if (scheme) openSchemeDetails(scheme._id);
    }
    
    function openGlobalSchemeDetails(schemeId){
      const scheme = globalSchemes.find(s => s._id === schemeId);
      if (scheme) {
        openModal('Global Scheme Details');
        document.getElementById('modalTitle').innerText = scheme.name;
        document.getElementById('modalBody').innerHTML = `<h4>Description</h4><p class='muted'>${escapeHtml(scheme.desc)}</p>
          <div style='text-align:center;background:#f8f9fa;padding:20px;border-radius:10px;margin:15px 0'>
            <h4 style='margin:0 0 15px 0;color:#333'>🌍 Global Funding Details</h4>
            <div style='text-align:left;max-width:600px;margin:0 auto'>
              <div style='margin:8px 0'><strong>💰 Funding Amount:</strong> ${scheme.funding}</div>
              <div style='margin:8px 0'><strong>🎯 Stage:</strong> ${scheme.stage}</div>
              <div style='margin:8px 0'><strong>🏢 Sector:</strong> ${scheme.sector}</div>
              <div style='margin:8px 0'><strong>🌍 Location:</strong> ${scheme.location}</div>
              <div style='margin:8px 0'><strong>✅ Eligibility:</strong> ${scheme.eligibility}</div>
            </div>
          </div>
          <div style='margin-top:15px;text-align:center'>
            <a class='btn primary' href='${scheme.applyLink}' target='_blank' rel='noopener'>Apply Directly</a>
            <a class='btn ghost' href='${scheme.link}' target='_blank' rel='noopener'>Learn More</a>
          </div>`;
      }
    }

    function openInvestor(investorId){
      const inv = investors.find(i => i._id === investorId);
      if (inv) {
        openModal(inv.name + ' — Profile');
        const investorCriteria = getInvestorCriteria(inv._id);
        document.getElementById('modalBody').innerHTML = `<p class='muted'>${escapeHtml(inv.desc)}</p>
          <div style='text-align:center;background:#f8f9fa;padding:20px;border-radius:10px;margin:15px 0'>
            <h4 style='margin:0 0 15px 0;color:#333'>💼 Investment Criteria</h4>
            <div style='text-align:left;max-width:600px;margin:0 auto'>
              ${investorCriteria}
            </div>
          </div>
          <div style='margin-top:15px;text-align:center'><button class='btn primary' onclick='checkInvestorEligibility("${inv._id}")'>Check Suitability</button> <button class='btn ghost' onclick='openInvestorApply("${inv._id}")'>Apply Now</button> <a class='btn ghost' href='${inv.website}' target='_blank' rel='noopener'>Visit Website</a></div>`;
      }
    }

    function openInvestorByName(investorName) {
      const inv = investors.find(i => i.name.includes(investorName));
      if (inv) openInvestor(inv._id);
    }

    function connectInvestor(id){
      alert('Demo: In a real app, this would send a request to connect with investor ID: ' + id);
      // You could implement a backend endpoint for this, e.g., POST /api/investors/:id/connect
    }

    // Basic apply flows (demo)
    function startApply(schemeId){
      openDirectApply(schemeId);
    }

    // Simple redirect to apply page
    function openApplyPage() {
      window.location.href = 'apply.html';
    }

    function handleQuickApply(e){
      e.preventDefault();
      alert('Quick application submitted! Demo mode - matches found.');
      document.getElementById('quickApply').reset();
    }

    function handleFullApply(e){
      e.preventDefault();
      alert('Full application submitted! Demo mode.');
      closeModal();
    }

    function handleContact(e){
      e.preventDefault();
      alert('Message sent successfully! Demo mode.');
      document.getElementById('cname').value = '';
      document.getElementById('cemail').value = '';
      document.getElementById('cmessage').value = '';
    }

    // User Management System
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
    
    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login_email').value;
      const password = document.getElementById('login_password').value;
      
      // Get stored users
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.email === email && u.password === password);
      
      if (user) {
        currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        alert(`Welcome back, ${user.name}!`);
        updateUIForLoggedInUser();
        closeModal();
      } else {
        alert('Invalid email or password. Please try again.');
      }
    }
    
    function handleSignup(e){
      e.preventDefault();
      const name = document.getElementById('su_name').value;
      const email = document.getElementById('su_email').value;
      const password = document.getElementById('su_password').value;
      const confirm = document.getElementById('su_confirm').value;
      const type = document.getElementById('su_type').value;
      
      // Validation
      if (password !== confirm) {
        alert('Passwords do not match!');
        return;
      }
      
      if (password.length < 6) {
        alert('Password must be at least 6 characters!');
        return;
      }
      
      // Check if user exists
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      if (users.find(u => u.email === email)) {
        alert('Account with this email already exists!');
        return;
      }
      
      // Create new user
      const newUser = {
        id: Date.now(),
        name,
        email,
        password,
        type,
        createdAt: new Date().toISOString()
      };
      
      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));
      
      // Auto login
      currentUser = newUser;
      localStorage.setItem('currentUser', JSON.stringify(newUser));
      
      alert(`Account created successfully! Welcome, ${name}!`);
      updateUIForLoggedInUser();
      closeModal();
    }
    
    function logout() {
      currentUser = null;
      localStorage.removeItem('currentUser');
      updateUIForLoggedInUser();
      alert('Logged out successfully!');
    }
    
    function forgotPassword() {
      const email = prompt('Enter your email address:');
      if (email) {
        alert('Password reset link sent to your email (Demo mode)');
      }
    }
    
    function updateUIForLoggedInUser() {
      const nav = document.querySelector('nav.primary');
      if (currentUser) {
        nav.innerHTML = `
          <a href="#government" class="active">Government</a>
          <a href="#investors">Private</a>
          <a href="#global">Global</a>
          <a href="#apply">Apply</a>
          <a href="#howto">How to Apply</a>
          <a href="#news">News</a>
          <a href="#contact">Contact</a>
          <a href="#community">Community</a>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="color:var(--muted);font-size:0.9rem">Hi, ${currentUser.name}</span>
            <button class="btn ghost" onclick="logout()" style="padding:6px 10px;font-size:0.85rem">Logout</button>
          </div>
        `;
      } else {
        nav.innerHTML = `
          <a href="#government" class="active">Government</a>
          <a href="#investors">Private</a>
          <a href="#global">Global</a>
          <a href="#apply">Apply</a>
          <a href="#howto">How to Apply</a>
          <a href="#news">News</a>
          <a href="#contact">Contact</a>
          <a href="#community">Community</a>
          <button class="cta" onclick="openModal('login')">Login</button>
          <button class="btn ghost" onclick="openModal('signup')" style="margin-left:8px;color:#fff">Sign up</button>
        `;
      }
    }
    
    // Check login status on page load
    function checkLoginStatus() {
      updateUIForLoggedInUser();
    }

    // Direct Apply Function
    function openDirectApply(schemeId) {
      const scheme = schemes.find(s => s._id === schemeId);
      if (scheme) {
        openModal('Complete Application - ' + scheme.name);
        document.getElementById('modalBody').innerHTML = `
          <form onsubmit="handleDirectApply(event, '${schemeId}')" style="max-height:70vh;overflow-y:auto;padding:10px">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div>
                <label for='da_name'>Startup Name *</label>
                <input id='da_name' type='text' required placeholder='Your startup name'/>
              </div>
              <div>
                <label for='da_founder'>Founder Name *</label>
                <input id='da_founder' type='text' required placeholder='Your full name'/>
              </div>
            </div>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
              <div>
                <label for='da_email'>Email *</label>
                <input id='da_email' type='email' required placeholder='contact@startup.com'/>
              </div>
              <div>
                <label for='da_phone'>Phone *</label>
                <input id='da_phone' type='tel' required placeholder='+91 9876543210'/>
              </div>
            </div>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
              <div>
                <label for='da_sector'>Sector *</label>
                <select id='da_sector' required>
                  <option value=''>Select Sector</option>
                  <option value='tech'>Technology</option>
                  <option value='agri'>Agriculture & Food</option>
                  <option value='health'>Healthcare & Biotech</option>
                  <option value='fintech'>Fintech</option>
                  <option value='energy'>Energy & Environment</option>
                  <option value='education'>Education</option>
                  <option value='manufacturing'>Manufacturing</option>
                </select>
              </div>
              <div>
                <label for='da_stage'>Current Stage *</label>
                <select id='da_stage' required>
                  <option value=''>Select Stage</option>
                  <option value='idea'>Idea Stage</option>
                  <option value='prototype'>Prototype</option>
                  <option value='mvp'>MVP Ready</option>
                  <option value='revenue'>Revenue Generating</option>
                  <option value='growth'>Scaling</option>
                </select>
              </div>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_entity'>Registered Entity *</label>
              <input id='da_entity' type='text' required placeholder='Pvt Ltd / LLP / Partnership / Proprietorship'/>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_funding'>Funding Required *</label>
              <select id='da_funding' required>
                <option value=''>Select Amount</option>
                <option value='5-10'>₹5-10 Lakhs</option>
                <option value='10-25'>₹10-25 Lakhs</option>
                <option value='25-50'>₹25-50 Lakhs</option>
                <option value='50-100'>₹50L-1Cr</option>
                <option value='1-5cr'>₹1-5Cr</option>
                <option value='5cr+'>₹5Cr+</option>
              </select>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_summary'>Business Summary *</label>
              <textarea id='da_summary' required placeholder='Brief description of your business (50 words)' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_business'>Product/Service Description *</label>
              <textarea id='da_business' required placeholder='Detailed description of your product/service, target market, unique value proposition...' rows='4'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_deck'>Pitch Deck URL</label>
              <input id='da_deck' type='url' placeholder='Google Drive / Dropbox link to your pitch deck'/>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_revenue'>Revenue Model *</label>
              <textarea id='da_revenue' required placeholder='How do you make money? Pricing strategy, revenue streams...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_team'>Team Details *</label>
              <textarea id='da_team' required placeholder='Founder(s) background, key team members, experience...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_market'>Market Analysis *</label>
              <textarea id='da_market' required placeholder='Market size, competition, target customers...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_financials'>Financial Information *</label>
              <textarea id='da_financials' required placeholder='Current revenue, burn rate, runway, previous funding...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='da_use'>Fund Utilization Plan *</label>
              <textarea id='da_use' required placeholder='How will you use the funding? Break down by categories...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label>Required Documents Checklist *</label>
              <div style='margin:8px 0;background:#f8f9fa;padding:12px;border-radius:8px'>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Company Registration Certificate *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> PAN Card *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Bank Account Details & Statements *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> GST Registration (if applicable) *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Business Plan/Pitch Deck *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> Audited Financials (if available)</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> IP/Patent Documents (if any)</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> MOA & AOA</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> Board Resolution for Fundraising</label>
              </div>
            </div>
            
            <div style="margin-top:12px">
              <label style='display:flex;align-items:center'>
                <input type='checkbox' required style='margin-right:8px'/>
                I confirm that all information provided is accurate and I have the authority to submit this application on behalf of the company.
              </label>
            </div>
            
            <div style='margin-top:20px;display:flex;gap:10px'>
              <button type='submit' class='btn primary'>Submit Complete Application</button>
              <button type='button' class='btn ghost' onclick='closeModal()'>Cancel</button>
            </div>
          </form>
        `;
      }
    }

    function handleDirectApply(e, schemeId) {
      e.preventDefault();
      const scheme = schemes.find(s => s._id === schemeId);
      const formData = {
        schemeName: scheme.name,
        startupName: document.getElementById('da_name').value,
        founderName: document.getElementById('da_founder').value,
        email: document.getElementById('da_email').value,
        phone: document.getElementById('da_phone').value,
        sector: document.getElementById('da_sector').value,
        stage: document.getElementById('da_stage').value,
        registeredEntity: document.getElementById('da_entity').value,
        fundingRequired: document.getElementById('da_funding').value,
        businessSummary: document.getElementById('da_summary').value,
        productDescription: document.getElementById('da_business').value,
        pitchDeckUrl: document.getElementById('da_deck').value,
        revenueModel: document.getElementById('da_revenue').value,
        teamDetails: document.getElementById('da_team').value,
        marketAnalysis: document.getElementById('da_market').value,
        financialInfo: document.getElementById('da_financials').value,
        fundUtilization: document.getElementById('da_use').value,
        applicationType: 'direct',
        timestamp: new Date().toISOString()
      };
      
      // Check eligibility automatically
      const isEligible = checkApplicationEligibility(formData, scheme);
      
      // Store application
      const applications = JSON.parse(localStorage.getItem('directApplications') || '[]');
      applications.push({...formData, eligible: isEligible});
      localStorage.setItem('directApplications', JSON.stringify(applications));
      
      // Send confirmation email
      sendApplicationConfirmationEmail(formData, scheme, isEligible);
      
      const applicationId = `DIR${Date.now()}`;
      alert(`Complete Application Submitted Successfully for ${scheme.name}!\n\nApplication ID: ${applicationId}\n\nEligibility Status: ${isEligible ? 'ELIGIBLE ✅' : 'UNDER REVIEW ⏳'}\n\nConfirmation email is being sent to: ${formData.email}\n\nPlease check your email (including spam folder) in 1-2 minutes.\n\nNext Steps:\n1. Document verification (3-5 business days)\n2. Eligibility assessment by scheme authorities\n3. Business evaluation & due diligence\n4. Interview/Presentation (if shortlisted)\n5. Final approval & fund disbursement\n\nTimeline: 2-6 weeks\n\nThank you for choosing our portal!`);
      closeModal();
    }
    
    function checkApplicationEligibility(formData, scheme) {
      // Basic eligibility checks
      let eligible = true;
      
      // Check sector match
      if (scheme.sector !== 'all' && formData.sector !== scheme.sector) {
        eligible = false;
      }
      
      // Check stage compatibility
      if (scheme.stage === 'idea' && !['idea', 'prototype'].includes(formData.stage)) {
        eligible = false;
      }
      
      // Check entity registration
      if (!formData.registeredEntity || formData.registeredEntity.trim() === '') {
        eligible = false;
      }
      
      return eligible;
    }
    
    function sendApplicationConfirmationEmail(formData, scheme, isEligible) {
      const applicationId = `DIR${Date.now()}`;
      const statusMessage = isEligible ? 
        'Congratulations! Your application meets the basic eligibility criteria.' :
        'Your application is under review for eligibility assessment.';
      
      // Validate email address
      if (!formData.email || !formData.email.includes('@') || !formData.email.includes('.')) {
        console.error('❌ Invalid email address:', formData.email);
        showInAppNotification('❌ Invalid email address. Please check and try again.');
        return;
      }
      
      const emailData = {
        to_name: formData.founderName || 'Applicant',
        to_email: formData.email.trim().toLowerCase(),
        subject: `Application Confirmation - ${scheme.name}`,
        message: `Dear ${formData.founderName},\n\nThank you for applying to ${scheme.name} through our Startup Funding Portal.\n\nAPPLICATION DETAILS:\n==================\nApplication ID: ${applicationId}\nStartup Name: ${formData.startupName}\nScheme: ${scheme.name}\nFunding Required: ${formData.fundingRequired}\nSubmission Date: ${new Date().toLocaleDateString()}\n\nELIGIBILITY STATUS:\n==================\n${isEligible ? 'ELIGIBLE' : 'UNDER REVIEW'}\n${statusMessage}\n\nNEXT STEPS:\n==================\n1. Document verification (3-5 business days)\n2. Eligibility assessment by scheme authorities\n3. Business evaluation and due diligence\n4. Interview/Presentation (if shortlisted)\n5. Final approval and fund disbursement\n\nTIMELINE: 2-6 weeks\n\nREQUIRED DOCUMENTS:\n==================\n- Company Registration Certificate\n- PAN Card\n- Bank Account Details and Statements\n- GST Registration (if applicable)\n- Business Plan/Pitch Deck\n- Audited Financials (if available)\n\nIMPORTANT NOTES:\n==================\n- Keep your application ID safe for future reference\n- You will receive updates via email\n- Ensure all documents are ready for verification\n- Contact us if you have any questions\n\nCONTACT INFORMATION:\n==================\nEmail: support@startupfundingportal.com\nPhone: +91-9876543210\nWebsite: https://startupfundingportal.com\n\nThank you for choosing our platform!\n\nBest regards,\nStartup Funding Portal Team\n\n---\nThis is an automated confirmation email.`
      };
      
      console.log('📧 Preparing to send application confirmation email...');
      console.log('📧 Email details:', {
        to: emailData.to_email,
        subject: emailData.subject,
        name: emailData.to_name
      });
      
      // Send email using Web3Forms
      sendRealEmailConfirmation(emailData);
    }
    
    function sendRealEmailConfirmation(emailData) {
      // Validate required fields
      if (!emailData.to_email || !emailData.subject || !emailData.message) {
        console.error('❌ Missing required email fields:', emailData);
        showInAppNotification('❌ Email data incomplete. Please try again.');
        return;
      }
      
      // Show sending notification
      showInAppNotification('📧 Sending confirmation email...');
      
      const formData = new FormData();
      formData.append('access_key', 'ed118f0d-a042-4590-a9ba-1413df33ace1');
      formData.append('subject', emailData.subject);
      formData.append('email', emailData.to_email);
      formData.append('name', emailData.to_name || 'User');
      formData.append('message', emailData.message);
      formData.append('from_name', 'Startup Funding Portal');
      formData.append('redirect', 'false');
      formData.append('botcheck', '');
      
      console.log('📧 === EMAIL DEBUG INFO ===');
      console.log('📧 Sending email to:', emailData.to_email);
      console.log('📧 Email subject:', emailData.subject);
      console.log('📧 Recipient name:', emailData.to_name);
      console.log('📧 Message length:', emailData.message.length);
      console.log('📧 Web3Forms API URL: https://api.web3forms.com/submit');
      console.log('📧 Access key: ed118f0d-a042-4590-a9ba-1413df33ace1');
      
      // Add timeout to the fetch request
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
      
      fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData,
        signal: controller.signal
      })
      .then(response => {
        clearTimeout(timeoutId);
        console.log('📧 HTTP Response status:', response.status);
        console.log('📧 HTTP Response ok:', response.ok);
        console.log('📧 HTTP Response headers:', response.headers);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        return response.json();
      })
      .then(data => {
        console.log('📧 === API RESPONSE ===');
        console.log('📧 Full response data:', JSON.stringify(data, null, 2));
        
        if (data.success === true) {
          console.log(`✅ Email sent successfully to ${emailData.to_email}`);
          showInAppNotification(`✅ Confirmation email sent successfully to ${emailData.to_email}! Please check your inbox (and spam folder).`);
          
          // Store successful email record
          const sentEmails = JSON.parse(localStorage.getItem('sentEmails') || '[]');
          sentEmails.push({
            to: emailData.to_email,
            subject: emailData.subject,
            sentAt: new Date().toISOString(),
            status: 'delivered',
            response: data
          });
          localStorage.setItem('sentEmails', JSON.stringify(sentEmails));
          
          // Show success details
          setTimeout(() => {
            alert(`✅ EMAIL SENT SUCCESSFULLY!\n\nTo: ${emailData.to_email}\nSubject: ${emailData.subject}\n\nPlease check your email inbox and spam folder.\nEmails usually arrive within 1-2 minutes.\n\nIf you don't receive the email:\n1. Check your spam/junk folder\n2. Verify your email address is correct\n3. Try again in a few minutes`);
          }, 1000);
        } else {
          console.error('❌ Email API returned success=false:', data);
          showInAppNotification(`❌ Email delivery failed: ${data.message || 'API returned success=false'}`);
        }
      })
      .catch(error => {
        clearTimeout(timeoutId);
        console.error('❌ === EMAIL ERROR ===');
        console.error('❌ Error type:', error.name);
        console.error('❌ Error message:', error.message);
        console.error('❌ Full error:', error);
        
        let errorMessage = 'Email service error';
        if (error.name === 'AbortError') {
          errorMessage = 'Email request timed out. Please try again.';
        } else if (error.message.includes('Failed to fetch')) {
          errorMessage = 'Network error. Please check your internet connection.';
        } else if (error.message.includes('HTTP')) {
          errorMessage = `Server error: ${error.message}`;
        }
        
        showInAppNotification(`❌ ${errorMessage}`);
        
        // Store failed email record
        const sentEmails = JSON.parse(localStorage.getItem('sentEmails') || '[]');
        sentEmails.push({
          to: emailData.to_email,
          subject: emailData.subject,
          sentAt: new Date().toISOString(),
          status: 'failed',
          error: error.message
        });
        localStorage.setItem('sentEmails', JSON.stringify(sentEmails));
      });
    }

    // Investor Apply Function
    function openInvestorApply(investorId) {
      const investor = investors.find(i => i._id === investorId);
      if (investor) {
        openModal('Apply to ' + investor.name);
        document.getElementById('modalBody').innerHTML = `
          <form onsubmit="handleInvestorApply(event, '${investorId}')" style="max-height:70vh;overflow-y:auto;padding:10px">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div>
                <label for='inv_startup'>Startup Name *</label>
                <input id='inv_startup' type='text' required placeholder='Your startup name'/>
              </div>
              <div>
                <label for='inv_founder'>Founder Name *</label>
                <input id='inv_founder' type='text' required placeholder='Your full name'/>
              </div>
            </div>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
              <div>
                <label for='inv_email'>Email *</label>
                <input id='inv_email' type='email' required placeholder='contact@startup.com'/>
              </div>
              <div>
                <label for='inv_phone'>Phone *</label>
                <input id='inv_phone' type='tel' required placeholder='+91 9876543210'/>
              </div>
            </div>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
              <div>
                <label for='inv_sector'>Sector *</label>
                <select id='inv_sector' required>
                  <option value=''>Select Sector</option>
                  <option value='tech'>Technology</option>
                  <option value='fintech'>Fintech</option>
                  <option value='health'>Healthcare & Biotech</option>
                  <option value='agri'>Agriculture & Food</option>
                  <option value='energy'>Energy & Environment</option>
                  <option value='education'>Education</option>
                  <option value='ecommerce'>E-commerce</option>
                  <option value='saas'>SaaS</option>
                </select>
              </div>
              <div>
                <label for='inv_stage'>Current Stage *</label>
                <select id='inv_stage' required>
                  <option value=''>Select Stage</option>
                  <option value='idea'>Idea Stage</option>
                  <option value='prototype'>Prototype</option>
                  <option value='mvp'>MVP</option>
                  <option value='revenue'>Revenue Generating</option>
                  <option value='growth'>Growth Stage</option>
                  <option value='series-a'>Series A Ready</option>
                </select>
              </div>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_funding'>Funding Required *</label>
              <select id='inv_funding' required>
                <option value=''>Select Amount</option>
                <option value='25-50'>₹25-50 Lakhs</option>
                <option value='50-100'>₹50L-1Cr</option>
                <option value='1-5cr'>₹1-5Cr</option>
                <option value='5-10cr'>₹5-10Cr</option>
                <option value='10cr+'>₹10Cr+</option>
              </select>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_valuation'>Current Valuation</label>
              <input id='inv_valuation' type='text' placeholder='Pre-money valuation (if applicable)'/>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_pitch'>Elevator Pitch *</label>
              <textarea id='inv_pitch' required placeholder='Describe your startup in 2-3 sentences. What problem do you solve?' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_traction'>Traction & Metrics *</label>
              <textarea id='inv_traction' required placeholder='Revenue, users, growth rate, key metrics...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_team'>Team Background *</label>
              <textarea id='inv_team' required placeholder='Founder(s) experience, key team members, domain expertise...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_market'>Market Opportunity *</label>
              <textarea id='inv_market' required placeholder='Market size, target customers, competitive advantage...' rows='3'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_deck'>Pitch Deck URL *</label>
              <input id='inv_deck' type='url' required placeholder='Google Drive/Dropbox link to your pitch deck'/>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_demo'>Product Demo URL</label>
              <input id='inv_demo' type='url' placeholder='Link to product demo/website'/>
            </div>
            
            <div style="margin-top:12px">
              <label for='inv_previous'>Previous Funding</label>
              <textarea id='inv_previous' placeholder='Previous investors, funding rounds, amounts raised...' rows='2'></textarea>
            </div>
            
            <div style="margin-top:12px">
              <label>Investment Documents Ready</label>
              <div style='margin:8px 0;background:#f8f9fa;padding:12px;border-radius:8px'>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Pitch Deck (10-15 slides) *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Financial Model & Projections *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' required style='margin-right:8px'/> Company Registration Documents *</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> Cap Table</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> Term Sheet Template</label>
                <label style='display:flex;align-items:center;margin:6px 0'><input type='checkbox' style='margin-right:8px'/> Due Diligence Folder</label>
              </div>
            </div>
            
            <div style="margin-top:12px">
              <label style='display:flex;align-items:center'>
                <input type='checkbox' required style='margin-right:8px'/>
                I confirm this information is accurate and I'm authorized to seek investment for this company.
              </label>
            </div>
            
            <div style='margin-top:20px;display:flex;gap:10px'>
              <button type='submit' class='btn primary'>Submit to ${investor.name}</button>
              <a class='btn ghost' href='${investor.applyLink}' target='_blank'>Official Portal</a>
              <button type='button' class='btn ghost' onclick='closeModal()'>Cancel</button>
            </div>
          </form>
        `;
      }
    }

    function handleInvestorApply(e, investorId) {
      e.preventDefault();
      const investor = investors.find(i => i._id === investorId);
      const formData = {
        investorName: investor.name,
        startupName: document.getElementById('inv_startup').value,
        founderName: document.getElementById('inv_founder').value,
        email: document.getElementById('inv_email').value,
        phone: document.getElementById('inv_phone').value,
        sector: document.getElementById('inv_sector').value,
        stage: document.getElementById('inv_stage').value,
        fundingRequired: document.getElementById('inv_funding').value,
        valuation: document.getElementById('inv_valuation').value,
        elevatorPitch: document.getElementById('inv_pitch').value,
        traction: document.getElementById('inv_traction').value,
        teamBackground: document.getElementById('inv_team').value,
        marketOpportunity: document.getElementById('inv_market').value,
        pitchDeckUrl: document.getElementById('inv_deck').value,
        demoUrl: document.getElementById('inv_demo').value,
        previousFunding: document.getElementById('inv_previous').value,
        applicationType: 'investor',
        timestamp: new Date().toISOString()
      };
      
      // Store application
      const applications = JSON.parse(localStorage.getItem('investorApplications') || '[]');
      applications.push(formData);
      localStorage.setItem('investorApplications', JSON.stringify(applications));
      
      // Send investor application confirmation email
      sendInvestorConfirmationEmail(formData, investor);
      
      const applicationId = `INV${Date.now()}`;
      alert(`Investment Application Submitted Successfully to ${investor.name}!\n\nApplication ID: ${applicationId}\n\nConfirmation email is being sent to: ${formData.email}\n\nPlease check your email (including spam folder) in 1-2 minutes.\n\nNext Steps:\n1. Initial screening (1-2 weeks)\n2. Pitch deck review\n3. Due diligence process\n4. Investment committee review\n5. Term sheet & funding (if approved)\n\nTimeline: 4-12 weeks\n\nYou will receive updates via email.`);
      closeModal();
    }
    
    function sendInvestorConfirmationEmail(formData, investor) {
      const applicationId = `INV${Date.now()}`;
      
      // Validate email address
      if (!formData.email || !formData.email.includes('@') || !formData.email.includes('.')) {
        console.error('❌ Invalid email address:', formData.email);
        showInAppNotification('❌ Invalid email address. Please check and try again.');
        return;
      }
      
      const emailData = {
        to_name: formData.founderName || 'Applicant',
        to_email: formData.email.trim().toLowerCase(),
        subject: `Investment Application Confirmation - ${investor.name}`,
        message: `Dear ${formData.founderName},\n\nThank you for submitting your investment application to ${investor.name} through our Startup Funding Portal.\n\nAPPLICATION DETAILS:\n==================\nApplication ID: ${applicationId}\nStartup Name: ${formData.startupName}\nInvestor: ${investor.name}\nFunding Required: ${formData.fundingRequired}\nStage: ${formData.stage}\nSector: ${formData.sector}\nSubmission Date: ${new Date().toLocaleDateString()}\n\nAPPLICATION STATUS:\n==================\nSUCCESSFULLY SUBMITTED\nYour application has been forwarded to ${investor.name} for review.\n\nNEXT STEPS:\n==================\n1. Initial screening by investment team (1-2 weeks)\n2. Pitch deck review and evaluation\n3. Due diligence process\n4. Investment committee review\n5. Term sheet negotiation (if approved)\n6. Final funding decision\n\nTIMELINE: 4-12 weeks\n\nREQUIRED DOCUMENTS:\n==================\n- Pitch Deck (10-15 slides)\n- Financial Model and Projections\n- Company Registration Documents\n- Cap Table (if applicable)\n- Due Diligence Folder\n- Product Demo/MVP\n\nTIPS FOR SUCCESS:\n==================\n- Ensure your pitch deck is compelling and concise\n- Have financial projections ready\n- Prepare for potential investor meetings\n- Keep your product demo updated\n- Be ready to discuss market opportunity\n\nCONTACT INFORMATION:\n==================\nEmail: support@startupfundingportal.com\nPhone: +91-9876543210\nInvestor Portal: ${investor.website}\n\nWe wish you the best of luck with your funding journey!\n\nBest regards,\nStartup Funding Portal Team\n\n---\nThis is an automated confirmation email.`
      };
      
      console.log('📧 Preparing to send investor confirmation email...');
      console.log('📧 Email details:', {
        to: emailData.to_email,
        subject: emailData.subject,
        name: emailData.to_name
      });
      
      sendRealEmailConfirmation(emailData);
    }

    // Eligibility Check Functions
    function checkEligibility(schemeId) {
      const scheme = schemes.find(s => s._id === schemeId);
      if (scheme) {
        openModal('Eligibility Check - ' + scheme.name);
        document.getElementById('modalBody').innerHTML = `
          <form onsubmit="handleEligibilityCheck(event, '${schemeId}')">
            <h4>Check Your Eligibility</h4>
            <p class='muted'>Answer these questions to check if you're eligible for ${scheme.name}</p>
            
            <label>Company Registration Status *</label>
            <select id='elig_registration' required>
              <option value=''>Select Status</option>
              <option value='pvt-ltd'>Private Limited Company</option>
              <option value='llp'>Limited Liability Partnership (LLP)</option>
              <option value='partnership'>Partnership Firm</option>
              <option value='proprietorship'>Sole Proprietorship</option>
              <option value='not-registered'>Not Registered Yet</option>
            </select>
            
            <label style='margin-top:12px'>Company Age</label>
            <select id='elig_age' required>
              <option value=''>Select Age</option>
              <option value='0-1'>Less than 1 year</option>
              <option value='1-3'>1-3 years</option>
              <option value='3-5'>3-5 years</option>
              <option value='5+'>More than 5 years</option>
            </select>
            
            <label style='margin-top:12px'>Annual Turnover</label>
            <select id='elig_turnover' required>
              <option value=''>Select Turnover</option>
              <option value='0'>No Revenue Yet</option>
              <option value='0-25'>Up to ₹25 Lakhs</option>
              <option value='25-100'>₹25L - ₹1Cr</option>
              <option value='100-500'>₹1Cr - ₹5Cr</option>
              <option value='500+'>Above ₹5Cr</option>
            </select>
            
            <label style='margin-top:12px'>Business Sector</label>
            <select id='elig_sector' required>
              <option value=''>Select Sector</option>
              <option value='tech'>Technology</option>
              <option value='agri'>Agriculture & Food</option>
              <option value='health'>Healthcare</option>
              <option value='manufacturing'>Manufacturing</option>
              <option value='services'>Services</option>
              <option value='other'>Other</option>
            </select>
            
            <label style='margin-top:12px'>Innovation/Technology Component</label>
            <select id='elig_innovation' required>
              <option value=''>Select Option</option>
              <option value='yes'>Yes, we have innovative technology/process</option>
              <option value='no'>No, traditional business model</option>
            </select>
            
            <label style='margin-top:12px'>DPIIT Recognition (for startups)</label>
            <select id='elig_dpiit'>
              <option value=''>Select Status</option>
              <option value='yes'>Yes, DPIIT recognized</option>
              <option value='applied'>Applied, pending approval</option>
              <option value='no'>Not applied</option>
              <option value='na'>Not applicable</option>
            </select>
            
            <div style='margin-top:20px;display:flex;gap:10px'>
              <button type='submit' class='btn primary'>Check Eligibility</button>
              <button type='button' class='btn ghost' onclick='closeModal()'>Cancel</button>
            </div>
          </form>
        `;
      }
    }

    function checkInvestorEligibility(investorId) {
      const investor = investors.find(i => i._id === investorId);
      if (investor) {
        openModal('Investment Eligibility - ' + investor.name);
        document.getElementById('modalBody').innerHTML = `
          <form onsubmit="handleInvestorEligibilityCheck(event, '${investorId}')">
            <h4>Check Investment Eligibility</h4>
            <p class='muted'>Verify if your startup meets ${investor.name}'s investment criteria</p>
            
            <label>Current Stage *</label>
            <select id='inv_elig_stage' required>
              <option value=''>Select Stage</option>
              <option value='idea'>Idea Stage</option>
              <option value='prototype'>Prototype</option>
              <option value='mvp'>MVP</option>
              <option value='revenue'>Revenue Generating</option>
              <option value='growth'>Growth Stage</option>
              <option value='series-a'>Series A Ready</option>
            </select>
            
            <label style='margin-top:12px'>Monthly Revenue</label>
            <select id='inv_elig_revenue' required>
              <option value=''>Select Revenue</option>
              <option value='0'>No Revenue</option>
              <option value='0-1'>₹0-1 Lakh</option>
              <option value='1-10'>₹1-10 Lakhs</option>
              <option value='10-50'>₹10-50 Lakhs</option>
              <option value='50+'>₹50+ Lakhs</option>
            </select>
            
            <label style='margin-top:12px'>Team Size</label>
            <select id='inv_elig_team' required>
              <option value=''>Select Team Size</option>
              <option value='1-2'>1-2 members</option>
              <option value='3-5'>3-5 members</option>
              <option value='6-10'>6-10 members</option>
              <option value='10+'>10+ members</option>
            </select>
            
            <label style='margin-top:12px'>Funding Required</label>
            <select id='inv_elig_funding' required>
              <option value=''>Select Amount</option>
              <option value='25-50'>₹25-50 Lakhs</option>
              <option value='50-100'>₹50L-1Cr</option>
              <option value='1-5'>₹1-5Cr</option>
              <option value='5-10'>₹5-10Cr</option>
              <option value='10+'>₹10Cr+</option>
            </select>
            
            <label style='margin-top:12px'>Market Traction</label>
            <select id='inv_elig_traction' required>
              <option value=''>Select Traction</option>
              <option value='none'>No customers yet</option>
              <option value='pilot'>Pilot customers</option>
              <option value='paying'>Paying customers</option>
              <option value='growing'>Growing customer base</option>
              <option value='scaled'>Scaled operations</option>
            </select>
            
            <label style='margin-top:12px'>Scalability Potential</label>
            <select id='inv_elig_scale' required>
              <option value=''>Select Potential</option>
              <option value='local'>Local market focus</option>
              <option value='national'>National scalability</option>
              <option value='global'>Global potential</option>
            </select>
            
            <div style='margin-top:20px;display:flex;gap:10px'>
              <button type='submit' class='btn primary'>Check Eligibility</button>
              <button type='button' class='btn ghost' onclick='closeModal()'>Cancel</button>
            </div>
          </form>
        `;
      }
    }

    function handleEligibilityCheck(e, schemeId) {
      e.preventDefault();
      const scheme = schemes.find(s => s._id === schemeId);
      const registration = document.getElementById('elig_registration').value;
      const age = document.getElementById('elig_age').value;
      const turnover = document.getElementById('elig_turnover').value;
      const sector = document.getElementById('elig_sector').value;
      const innovation = document.getElementById('elig_innovation').value;
      const dpiit = document.getElementById('elig_dpiit').value;
      
      let eligible = true;
      let issues = [];
      
      // Basic eligibility checks
      if (registration === 'not-registered') {
        eligible = false;
        issues.push('Company registration required');
      }
      
      if (scheme.state === 'central' && innovation === 'no') {
        issues.push('Innovation component preferred for central schemes');
      }
      
      if (scheme.sector !== 'all' && sector !== scheme.sector) {
        eligible = false;
        issues.push(`This scheme is specifically for ${scheme.sector} sector`);
      }
      
      const result = eligible ? 'ELIGIBLE' : 'NOT ELIGIBLE';
      const color = eligible ? '#10b981' : '#ef4444';
      
      openModal('Eligibility Result - ' + scheme.name);
      document.getElementById('modalBody').innerHTML = `
        <div style='text-align:center'>
          <h3 style='color:${color};margin:0'>${result}</h3>
          <p class='muted'>for ${scheme.name}</p>
        </div>
        
        ${issues.length > 0 ? `
          <h4>Requirements to Address:</h4>
          <ul style='color:#ef4444'>
            ${issues.map(issue => `<li>${issue}</li>`).join('')}
          </ul>
        ` : '<p style="color:#10b981">✅ You meet all basic eligibility criteria!</p>'}
        
        <h4>Next Steps:</h4>
        <ul class='muted'>
          <li>Review complete eligibility on official portal</li>
          <li>Prepare required documents</li>
          <li>Submit application through our portal or official website</li>
        </ul>
        
        <div style='margin-top:20px;display:flex;gap:10px'>
          ${eligible ? `<button class='btn primary' onclick='openDirectApply("${schemeId}")'>Apply Now</button>` : ''}
          <a class='btn ghost' href='${scheme.link}' target='_blank'>Official Portal</a>
          <button class='btn ghost' onclick='closeModal()'>Close</button>
        </div>
      `;
    }

    function handleInvestorEligibilityCheck(e, investorId) {
      e.preventDefault();
      const investor = investors.find(i => i._id === investorId);
      const stage = document.getElementById('inv_elig_stage').value;
      const revenue = document.getElementById('inv_elig_revenue').value;
      const team = document.getElementById('inv_elig_team').value;
      const funding = document.getElementById('inv_elig_funding').value;
      const traction = document.getElementById('inv_elig_traction').value;
      const scale = document.getElementById('inv_elig_scale').value;
      
      let score = 0;
      let feedback = [];
      
      // Scoring logic
      if (stage === 'revenue' || stage === 'growth') score += 2;
      else if (stage === 'mvp') score += 1;
      
      if (revenue !== '0') score += 2;
      if (team === '3-5' || team === '6-10') score += 1;
      if (traction === 'paying' || traction === 'growing') score += 2;
      if (scale === 'national' || scale === 'global') score += 1;
      
      let result, color, message;
      if (score >= 6) {
        result = 'HIGHLY SUITABLE';
        color = '#10b981';
        message = 'Your startup is an excellent fit for this investor!';
      } else if (score >= 4) {
        result = 'SUITABLE';
        color = '#f59e0b';
        message = 'Your startup meets most criteria. Consider strengthening weak areas.';
      } else {
        result = 'NEEDS IMPROVEMENT';
        color = '#ef4444';
        message = 'Focus on building traction and revenue before approaching this investor.';
      }
      
      openModal('Investment Suitability - ' + investor.name);
      document.getElementById('modalBody').innerHTML = `
        <div style='text-align:center'>
          <h3 style='color:${color};margin:0'>${result}</h3>
          <p class='muted'>${message}</p>
        </div>
        
        <h4>Recommendations:</h4>
        <ul class='muted'>
          ${score < 6 ? '<li>Build stronger revenue traction</li>' : ''}
          ${traction === 'none' ? '<li>Acquire pilot customers first</li>' : ''}
          ${team === '1-2' ? '<li>Consider expanding core team</li>' : ''}
          <li>Prepare a compelling pitch deck</li>
          <li>Have financial projections ready</li>
        </ul>
        
        <div style='margin-top:20px;display:flex;gap:10px'>
          ${score >= 4 ? `<button class='btn primary' onclick='openInvestorApply("${investorId}")'>Apply Now</button>` : ''}
          <a class='btn ghost' href='${investor.website}' target='_blank'>Learn More</a>
          <button class='btn ghost' onclick='closeModal()'>Close</button>
        </div>
      `;
    }

    // Get detailed eligibility criteria for schemes
    function getSchemeEligibility(schemeId) {
      const eligibilityMap = {
        '1': `<ul style='margin:0;padding-left:20px'>
          <li>DPIIT recognized startup (Certificate required)</li>
          <li>Incorporated as Private Limited Company or LLP</li>
          <li>Company age: Less than 10 years from incorporation</li>
          <li>Annual turnover: Less than ₹100 Crores in any financial year</li>
          <li>Working on innovation/development of new products or services</li>
          <li>Not formed by splitting up or reconstruction of existing business</li>
        </ul>`,
        '2': `<ul style='margin:0;padding-left:20px'>
          <li>Biotechnology/Life Sciences startup</li>
          <li>Registered company (Pvt Ltd/LLP/Partnership)</li>
          <li>Innovative biotech product or service</li>
          <li>Early-stage company (Seed to Series A)</li>
          <li>Indian entity with Indian promoters (>51%)</li>
          <li>Technology readiness level 3-6</li>
        </ul>`,
        '3': `<ul style='margin:0;padding-left:20px'>
          <li>Student, faculty, or researcher from recognized institution</li>
          <li>Technology-based innovative idea</li>
          <li>Proof of concept stage</li>
          <li>Indian citizen or OCI holder</li>
          <li>Age: 18-35 years for individual applicants</li>
          <li>Not availed similar support from other schemes</li>
        </ul>`,
        '4': `<ul style='margin:0;padding-left:20px'>
          <li>DPIIT recognized startup</li>
          <li>Innovative and scalable business model</li>
          <li>Technology-driven solution</li>
          <li>Registered in India</li>
          <li>Working towards commercialization</li>
          <li>Social or economic impact potential</li>
        </ul>`
      };
      
      // Default eligibility for other schemes
      const defaultEligibility = `<ul style='margin:0;padding-left:20px'>
        <li>Registered business entity in respective state</li>
        <li>Innovative business model or technology</li>
        <li>Compliance with state startup policy</li>
        <li>Indian promoters with majority stake</li>
        <li>Age limit: Company less than 7 years old</li>
        <li>Annual turnover as per scheme guidelines</li>
      </ul>`;
      
      return eligibilityMap[schemeId] || defaultEligibility;
    }

    // Get investment criteria for investors
    function getInvestorCriteria(investorId) {
      const criteriaMap = {
        '1': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Seed to Series A</li>
          <li><strong>Ticket Size:</strong> ₹25L - ₹2Cr</li>
          <li><strong>Sectors:</strong> Technology, Healthcare, Fintech</li>
          <li><strong>Revenue:</strong> Pre-revenue to ₹10Cr ARR</li>
          <li><strong>Team:</strong> Experienced founders with domain expertise</li>
          <li><strong>Market:</strong> Large addressable market (₹1000Cr+)</li>
        </ul>`,
        '2': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Series A to Growth</li>
          <li><strong>Ticket Size:</strong> ₹5Cr - ₹100Cr</li>
          <li><strong>Sectors:</strong> Technology, Consumer Internet, SaaS</li>
          <li><strong>Revenue:</strong> ₹2Cr+ ARR with 100%+ growth</li>
          <li><strong>Team:</strong> Proven execution track record</li>
          <li><strong>Market:</strong> Category-defining potential</li>
        </ul>`,
        '3': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Series A to Series C</li>
          <li><strong>Ticket Size:</strong> ₹10Cr - ₹50Cr</li>
          <li><strong>Sectors:</strong> Technology, Fintech, Enterprise SaaS</li>
          <li><strong>Revenue:</strong> ₹5Cr+ ARR, strong unit economics</li>
          <li><strong>Team:</strong> World-class founding team</li>
          <li><strong>Market:</strong> Global scalability potential</li>
        </ul>`,
        '4': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Idea to Early Revenue</li>
          <li><strong>Ticket Size:</strong> ₹50L - ₹5Cr</li>
          <li><strong>Sectors:</strong> Deep Tech, IoT, AI/ML</li>
          <li><strong>Revenue:</strong> Pre-revenue to ₹2Cr</li>
          <li><strong>Team:</strong> Technical founders with innovation</li>
          <li><strong>Market:</strong> Technology disruption potential</li>
        </ul>`,
        '5': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Seed to Series A</li>
          <li><strong>Ticket Size:</strong> ₹1Cr - ₹10Cr</li>
          <li><strong>Sectors:</strong> Consumer, Mobile, SaaS</li>
          <li><strong>Revenue:</strong> Strong traction metrics</li>
          <li><strong>Team:</strong> Passionate, coachable founders</li>
          <li><strong>Market:</strong> Large, growing market opportunity</li>
        </ul>`,
        '6': `<ul style='margin:0;padding-left:20px'>
          <li><strong>Stage:</strong> Seed to Series B</li>
          <li><strong>Ticket Size:</strong> ₹2Cr - ₹25Cr</li>
          <li><strong>Sectors:</strong> Consumer Internet, Fintech, Healthcare</li>
          <li><strong>Revenue:</strong> Product-market fit achieved</li>
          <li><strong>Team:</strong> Strong execution capabilities</li>
          <li><strong>Market:</strong> Significant market opportunity</li>
        </ul>`
      };
      
      return criteriaMap[investorId] || `<ul style='margin:0;padding-left:20px'>
        <li><strong>Stage:</strong> As per investment thesis</li>
        <li><strong>Sectors:</strong> Focus area alignment required</li>
        <li><strong>Team:</strong> Strong founding team</li>
        <li><strong>Market:</strong> Large market opportunity</li>
      </ul>`;
    }

    // Community Discussion System
    let discussions = JSON.parse(localStorage.getItem('discussions') || '[]');
    
    function openNewDiscussion() {
      if (!currentUser) {
        alert('Please login to start a discussion');
        openModal('login');
        return;
      }
      
      openModal('Start New Discussion');
      document.getElementById('modalBody').innerHTML = `
        <form onsubmit="handleNewDiscussion(event)">
          <label for='disc_title'>Discussion Title *</label>
          <input id='disc_title' type='text' required placeholder='What would you like to discuss?'/>
          
          <label for='disc_category'>Category *</label>
          <select id='disc_category' required>
            <option value=''>Select Category</option>
            <option value='funding'>💰 Funding Questions</option>
            <option value='mentorship'>🎯 Mentorship</option>
            <option value='networking'>🤝 Networking</option>
            <option value='resources'>📚 Resources</option>
          </select>
          
          <label for='disc_content'>Description *</label>
          <textarea id='disc_content' required placeholder='Describe your question or topic in detail...' rows='5'></textarea>
          
          <label for='disc_tags'>Tags (optional)</label>
          <input id='disc_tags' type='text' placeholder='startup, funding, mentor (comma separated)'/>
          
          <div style='margin-top:16px;display:flex;gap:10px'>
            <button type='submit' class='btn primary'>Post Discussion</button>
            <button type='button' class='btn ghost' onclick='closeModal()'>Cancel</button>
          </div>
        </form>
      `;
    }
    
    function handleNewDiscussion(e) {
      e.preventDefault();
      
      const newDiscussion = {
        id: Date.now(),
        title: document.getElementById('disc_title').value,
        category: document.getElementById('disc_category').value,
        content: document.getElementById('disc_content').value,
        tags: document.getElementById('disc_tags').value.split(',').map(t => t.trim()).filter(t => t),
        author: currentUser.name,
        authorType: currentUser.type,
        authorId: currentUser.id,
        createdAt: new Date().toISOString(),
        replies: [],
        likes: 0,
        likedBy: []
      };
      
      discussions.unshift(newDiscussion);
      localStorage.setItem('discussions', JSON.stringify(discussions));
      
      alert('Discussion posted successfully!');
      closeModal();
      renderDiscussions();
    }
    
    function renderDiscussions() {
      const container = document.getElementById('discussionsList');
      const filter = document.getElementById('discussionFilter')?.value || 'all';
      
      let filteredDiscussions = discussions;
      if (filter !== 'all') {
        filteredDiscussions = discussions.filter(d => d.category === filter);
      }
      
      if (filteredDiscussions.length === 0) {
        container.innerHTML = `
          <div style='text-align:center;padding:40px;color:var(--muted)'>
            <h3>No discussions yet</h3>
            <p>Be the first to start a conversation!</p>
            <button class='btn primary' onclick='openNewDiscussion()'>Start Discussion</button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filteredDiscussions.map(discussion => `
        <div class='card' style='margin-bottom:16px;cursor:pointer' onclick='openDiscussion(${discussion.id})'>
          <div style='display:flex;justify-content:space-between;align-items:start'>
            <div style='flex:1'>
              <h3 style='margin:0 0 8px 0'>${escapeHtml(discussion.title)}</h3>
              <p class='muted' style='margin:0 0 8px 0'>${escapeHtml(discussion.content.substring(0, 150))}${discussion.content.length > 150 ? '...' : ''}</p>
              <div style='display:flex;gap:8px;align-items:center;flex-wrap:wrap'>
                <span class='tag'>${getCategoryIcon(discussion.category)} ${discussion.category}</span>
                <span class='muted' style='font-size:0.85rem'>👤 ${discussion.author} (${discussion.authorType})</span>
                <span class='muted' style='font-size:0.85rem'>🕰️ ${formatDate(discussion.createdAt)}</span>
                <span class='muted' style='font-size:0.85rem'>💬 ${discussion.replies.length} replies</span>
                <span class='muted' style='font-size:0.85rem'>❤️ ${discussion.likes} likes</span>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function openDiscussion(discussionId) {
      const discussion = discussions.find(d => d.id === discussionId);
      if (!discussion) return;
      
      openModal(discussion.title);
      document.getElementById('modalBody').innerHTML = `
        <div style='max-height:70vh;overflow-y:auto'>
          <div style='margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid #eee'>
            <h4 style='margin:0 0 8px 0'>${escapeHtml(discussion.title)}</h4>
            <div style='display:flex;gap:8px;align-items:center;margin-bottom:12px'>
              <span class='tag'>${getCategoryIcon(discussion.category)} ${discussion.category}</span>
              <span class='muted'>👤 ${discussion.author} (${discussion.authorType})</span>
              <span class='muted'>🕰️ ${formatDate(discussion.createdAt)}</span>
            </div>
            <p style='margin:0;line-height:1.6'>${escapeHtml(discussion.content)}</p>
            <div style='margin-top:12px;display:flex;gap:8px'>
              <button class='btn ghost' onclick='likeDiscussion(${discussion.id})' style='font-size:0.85rem'>
                ❤️ ${discussion.likes} ${discussion.likedBy.includes(currentUser?.id) ? '(Liked)' : 'Like'}
              </button>
              ${currentUser ? `<button class='btn ghost' onclick='showReplyForm(${discussion.id})' style='font-size:0.85rem'>💬 Reply</button>` : ''}
            </div>
          </div>
          
          <div id='replyForm-${discussion.id}' style='display:none;margin-bottom:16px'></div>
          
          <div>
            <h4>Replies (${discussion.replies.length})</h4>
            <div id='repliesList'>
              ${discussion.replies.map(reply => `
                <div style='background:#f8f9fa;padding:12px;border-radius:8px;margin-bottom:8px'>
                  <div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:8px'>
                    <span style='font-weight:600'>👤 ${reply.author} (${reply.authorType})</span>
                    <span class='muted' style='font-size:0.85rem'>${formatDate(reply.createdAt)}</span>
                  </div>
                  <p style='margin:0;line-height:1.5'>${escapeHtml(reply.content)}</p>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    function showReplyForm(discussionId) {
      if (!currentUser) {
        alert('Please login to reply');
        return;
      }
      
      const formContainer = document.getElementById(`replyForm-${discussionId}`);
      formContainer.style.display = 'block';
      formContainer.innerHTML = `
        <form onsubmit='handleReply(event, ${discussionId})'>
          <label>Your Reply</label>
          <textarea id='reply-${discussionId}' required placeholder='Share your thoughts...' rows='3'></textarea>
          <div style='margin-top:8px;display:flex;gap:8px'>
            <button type='submit' class='btn primary' style='font-size:0.85rem'>Post Reply</button>
            <button type='button' class='btn ghost' onclick='hideReplyForm(${discussionId})' style='font-size:0.85rem'>Cancel</button>
          </div>
        </form>
      `;
    }
    
    function hideReplyForm(discussionId) {
      document.getElementById(`replyForm-${discussionId}`).style.display = 'none';
    }
    
    function handleReply(e, discussionId) {
      e.preventDefault();
      
      const replyContent = document.getElementById(`reply-${discussionId}`).value;
      const discussion = discussions.find(d => d.id === discussionId);
      
      const newReply = {
        id: Date.now(),
        content: replyContent,
        author: currentUser.name,
        authorType: currentUser.type,
        authorId: currentUser.id,
        createdAt: new Date().toISOString()
      };
      
      discussion.replies.push(newReply);
      localStorage.setItem('discussions', JSON.stringify(discussions));
      
      alert('Reply posted successfully!');
      openDiscussion(discussionId); // Refresh the discussion view
    }
    
    function likeDiscussion(discussionId) {
      if (!currentUser) {
        alert('Please login to like discussions');
        return;
      }
      
      const discussion = discussions.find(d => d.id === discussionId);
      const userLiked = discussion.likedBy.includes(currentUser.id);
      
      if (userLiked) {
        discussion.likes--;
        discussion.likedBy = discussion.likedBy.filter(id => id !== currentUser.id);
      } else {
        discussion.likes++;
        discussion.likedBy.push(currentUser.id);
      }
      
      localStorage.setItem('discussions', JSON.stringify(discussions));
      openDiscussion(discussionId); // Refresh the discussion view
    }
    
    function filterDiscussions() {
      renderDiscussions();
    }
    
    function getCategoryIcon(category) {
      const icons = {
        funding: '💰',
        mentorship: '🎯',
        networking: '🤝',
        resources: '📚'
      };
      return icons[category] || '💬';
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      return date.toLocaleDateString();
    }
    
    // Add sample discussions for demo
    function addSampleDiscussions() {
      if (discussions.length === 0) {
        const sampleDiscussions = [
          {
            id: 1,
            title: 'How to prepare for Series A funding?',
            category: 'funding',
            content: 'I\'m a first-time founder and my startup has gained good traction. We\'re looking to raise Series A funding. What should I prepare and what metrics do VCs typically look for?',
            tags: ['series-a', 'funding', 'metrics'],
            author: 'Priya Sharma',
            authorType: 'founder',
            authorId: 999,
            createdAt: new Date(Date.now() - 86400000).toISOString(),
            replies: [
              {
                id: 101,
                content: 'Focus on your unit economics, customer acquisition cost, and lifetime value. VCs want to see a clear path to profitability.',
                author: 'Rajesh Mentor',
                authorType: 'advisor',
                authorId: 998,
                createdAt: new Date(Date.now() - 43200000).toISOString()
              }
            ],
            likes: 5,
            likedBy: []
          },
          {
            id: 2,
            title: 'Looking for a technical co-founder',
            category: 'networking',
            content: 'I have a validated business idea in the fintech space and need a technical co-founder with experience in mobile app development and backend systems.',
            tags: ['co-founder', 'fintech', 'technical'],
            author: 'Amit Kumar',
            authorType: 'founder',
            authorId: 997,
            createdAt: new Date(Date.now() - 172800000).toISOString(),
            replies: [],
            likes: 3,
            likedBy: []
          }
        ];
        
        discussions = sampleDiscussions;
        localStorage.setItem('discussions', JSON.stringify(discussions));
      }
    }

    // Auto-Update System for Schemes
    let latestUpdates = JSON.parse(localStorage.getItem('latestUpdates') || '[]');
    let subscribers = JSON.parse(localStorage.getItem('updateSubscribers') || '[]');
    let lastUpdateCheck = localStorage.getItem('lastUpdateCheck') || new Date().toISOString();
    
    function subscribeToUpdates() {
      if (!currentUser) {
        alert('Please login to subscribe to updates');
        openModal('login');
        return;
      }
      
      if (subscribers.find(s => s.email === currentUser.email)) {
        alert('You are already subscribed to updates!');
        return;
      }
      
      const subscriber = {
        id: Date.now(),
        name: currentUser.name,
        email: currentUser.email,
        subscribedAt: new Date().toISOString(),
        preferences: ['new-schemes', 'deadlines', 'policy-updates']
      };
      
      subscribers.push(subscriber);
      localStorage.setItem('updateSubscribers', JSON.stringify(subscribers));
      
      alert(`✅ Successfully subscribed to updates!\n\nYou will receive notifications for:\n• New funding schemes\n• Application deadlines\n• Policy updates\n\nNotifications will be sent to: ${currentUser.email}`);
      updateStatistics();
    }
    
    function checkForNewSchemes() {
      // Simulate checking for new schemes (in real app, this would be an API call)
      const currentTime = new Date();
      const lastCheck = new Date(lastUpdateCheck);
      const timeDiff = currentTime - lastCheck;
      
      // Check every 24 hours (86400000 ms)
      if (timeDiff > 86400000) {
        simulateNewSchemeUpdate();
        lastUpdateCheck = currentTime.toISOString();
        localStorage.setItem('lastUpdateCheck', lastUpdateCheck);
      }
    }
    
    function simulateNewSchemeUpdate() {
      // Simulate new schemes being added
      const newSchemes = [
        {
          id: Date.now(),
          title: 'Digital India Innovation Fund 2025',
          description: 'New ₹500 Cr fund for digital innovation startups. Applications open from March 2025.',
          type: 'new-scheme',
          category: 'Government',
          deadline: '2025-04-30',
          fundingAmount: 'Up to ₹2 Crores',
          eligibility: 'DPIIT recognized startups in digital innovation',
          link: 'https://digitalindia.gov.in/innovation-fund',
          createdAt: new Date().toISOString()
        },
        {
          id: Date.now() + 1,
          title: 'Green Energy Startup Accelerator',
          description: 'Ministry of New & Renewable Energy launches accelerator program for clean energy startups.',
          type: 'upcoming',
          category: 'Government',
          deadline: '2025-03-15',
          fundingAmount: 'Up to ₹1 Crore + Mentorship',
          eligibility: 'Clean energy and sustainability focused startups',
          link: 'https://mnre.gov.in/startup-accelerator',
          createdAt: new Date().toISOString()
        }
      ];
      
      // Add to latest updates
      latestUpdates = [...newSchemes, ...latestUpdates].slice(0, 10); // Keep only latest 10
      localStorage.setItem('latestUpdates', JSON.stringify(latestUpdates));
      
      // Send email notifications
      sendEmailNotifications(newSchemes);
      
      // Update UI
      renderLatestUpdates();
      updateStatistics();
    }
    
    function sendEmailNotifications(newSchemes) {
      if (subscribers.length === 0) return;
      
      const emailContent = newSchemes.map(scheme => 
        `• ${scheme.title}\n  ${scheme.description}\n  Deadline: ${scheme.deadline}\n  Apply: ${scheme.link}`
      ).join('\n\n');
      
      // Use EmailJS service for real email sending
      subscribers.forEach(subscriber => {
        const emailData = {
          to_name: subscriber.name,
          to_email: subscriber.email,
          subject: '📢 New Funding Schemes Available!',
          message: `Hi ${subscriber.name},\n\nExciting news! New funding opportunities are now available:\n\n${emailContent}\n\nDon't miss out on these opportunities!\n\nBest regards,\nStartup Funding Portal Team\n\nUnsubscribe: Reply with 'UNSUBSCRIBE'`
        };
        
        // Real email sending using EmailJS (free service)
        sendRealEmail(emailData);
      });
      
      // Show success notification
      if (subscribers.length > 0) {
        setTimeout(() => {
          alert(`✅ Email notifications processing...\n\n${newSchemes.length} new funding schemes\nSending to ${subscribers.length} subscribers\n\nEmails will arrive in 1-2 minutes.\nCheck your inbox and spam folder!`);
        }, 1000);
      }
    }
    
    function sendRealEmail(emailData) {
      // Use Web3Forms for all email sending
      const formData = new FormData();
      formData.append('access_key', 'ed118f0d-a042-4590-a9ba-1413df33ace1');
      formData.append('subject', emailData.subject);
      formData.append('email', emailData.to_email);
      formData.append('name', emailData.to_name);
      formData.append('message', emailData.message);
      formData.append('from_name', 'Startup Funding Portal');
      formData.append('redirect', 'false');
      formData.append('botcheck', '');
      
      console.log('📧 Sending notification email to:', emailData.to_email);
      
      fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          console.log(`✅ Notification email sent successfully to ${emailData.to_email}`);
          // Store sent email record
          const sentEmails = JSON.parse(localStorage.getItem('sentEmails') || '[]');
          sentEmails.push({
            to: emailData.to_email,
            subject: emailData.subject,
            sentAt: new Date().toISOString(),
            status: 'delivered'
          });
          localStorage.setItem('sentEmails', JSON.stringify(sentEmails));
        } else {
          console.error(`❌ Failed to send notification email to ${emailData.to_email}:`, data.message);
          showBrowserNotification(emailData);
        }
      })
      .catch(error => {
        console.error('❌ Email service error:', error);
        showBrowserNotification(emailData);
      });
    }
    
    function showBrowserNotification(emailData) {
      // Request notification permission
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification('📢 New Funding Schemes!', {
              body: `Hi ${emailData.to_name}, new funding opportunities are available. Check the portal for details.`,
              icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">💰</text></svg>',
              tag: 'funding-update'
            });
          }
        });
      }
      
      // Also show in-app notification
      showInAppNotification(`New funding schemes available! Check your email or visit the News section.`);
    }
    
    function showInAppNotification(message) {
      const notification = document.createElement('div');
      const isError = message.includes('❌') || message.includes('⚠️') || message.includes('failed') || message.includes('error');
      const bgColor = isError ? 'linear-gradient(90deg, #ef4444, #dc2626)' : 'linear-gradient(90deg, #10b981, #06b6d4)';
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 16px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        z-index: 10000;
        max-width: 350px;
        font-weight: 600;
        animation: slideIn 0.3s ease-out;
        word-wrap: break-word;
      `;
      
      notification.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 8px;">
          <span style="flex-shrink: 0;">${isError ? '❌' : '📧'}</span>
          <span style="flex: 1; line-height: 1.4;">${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; flex-shrink: 0;">×</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto remove after 8 seconds for errors, 5 seconds for success
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, isError ? 8000 : 5000);
    }
    
    function renderLatestUpdates() {
      const container = document.getElementById('latestUpdates');
      
      if (latestUpdates.length === 0) {
        container.innerHTML = `
          <div class="card">
            <h3 style="margin:0">Green Energy Innovation Scheme — (Planned)</h3>
            <p class="muted">Dedicated grants for green energy startups. Keep an eye — expected roll-out Q4 2025.</p>
          </div>
          <div style="height:12px"></div>
          <div class="card">
            <h3 style="margin:0">Global Startup Exchange — pilot announced</h3>
            <p class="muted">An initiative to connect Indian startups with international investors and market access.</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = latestUpdates.map(update => `
        <div class="card" style="margin-bottom:12px;${isNewUpdate(update.createdAt) ? 'border-left:4px solid #10b981;' : ''}">
          <div style="display:flex;justify-content:space-between;align-items:start">
            <div style="flex:1">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                <h3 style="margin:0">${escapeHtml(update.title)}</h3>
                ${isNewUpdate(update.createdAt) ? '<span class="tag" style="background:#10b981;color:#fff;font-size:0.75rem">NEW</span>' : ''}
                <span class="tag">${update.type === 'new-scheme' ? '🆕 New' : '🕰️ Upcoming'}</span>
              </div>
              <p class="muted" style="margin:0 0 8px 0">${escapeHtml(update.description)}</p>
              <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;font-size:0.85rem">
                <span class="muted">💰 ${update.fundingAmount}</span>
                <span class="muted">📅 Deadline: ${formatDate(update.deadline)}</span>
                <a href="${update.link}" target="_blank" class="btn ghost" style="padding:4px 8px;font-size:0.8rem">Learn More</a>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function isNewUpdate(createdAt) {
      const updateTime = new Date(createdAt);
      const now = new Date();
      const diffHours = (now - updateTime) / (1000 * 60 * 60);
      return diffHours < 48; // Consider new if less than 48 hours old
    }
    
    function updateStatistics() {
      const newSchemesCount = latestUpdates.filter(u => u.type === 'new-scheme').length;
      document.getElementById('newSchemesCount').textContent = newSchemesCount;
      document.getElementById('subscribersCount').textContent = subscribers.length;
      document.getElementById('lastUpdateTime').textContent = formatDate(lastUpdateCheck);
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffDays === 0) return 'Today';
      if (diffDays === 1) return 'Yesterday';
      if (diffDays < 7) return `${diffDays} days ago`;
      return date.toLocaleDateString();
    }
    
    // Auto-check for updates every hour
    setInterval(checkForNewSchemes, 3600000); // 1 hour = 3600000 ms
    
    // Manual trigger for demo (remove in production)
    function triggerUpdateDemo() {
      simulateNewSchemeUpdate();
    }
    
    // Add CSS for notification animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
    // Email status checking
    function checkEmailStatus() {
      const sentEmails = JSON.parse(localStorage.getItem('sentEmails') || '[]');
      const recentEmails = sentEmails.slice(-10); // Last 10 emails
      
      if (recentEmails.length === 0) {
        alert('No emails sent yet. Try sending a test email first.');
        return;
      }
      
      const statusReport = recentEmails.map(email => {
        const time = new Date(email.sentAt).toLocaleString();
        const status = email.status === 'delivered' ? '✅ Delivered' : '❌ Failed';
        return `${status} - ${email.to} - ${time}`;
      }).join('\n');
      
      const delivered = recentEmails.filter(e => e.status === 'delivered').length;
      const failed = recentEmails.filter(e => e.status === 'failed').length;
      
      alert(`📧 EMAIL STATUS REPORT\n\nRecent Emails (Last 10):\n${statusReport}\n\nSUMMARY:\n✅ Delivered: ${delivered}\n❌ Failed: ${failed}\n\nDelivery Rate: ${Math.round((delivered / recentEmails.length) * 100)}%`);
    }
    
    // Test email function
    function testEmailSystem() {
      const testEmail = prompt('Enter your email address to test the email system:');
      if (!testEmail || !testEmail.includes('@') || !testEmail.includes('.')) {
        alert('Please enter a valid email address (e.g., user@gmail.com)');
        return;
      }
      
      const testEmailData = {
        to_name: 'Test User',
        to_email: testEmail.trim().toLowerCase(),
        subject: 'Email System Test - Startup Funding Portal',
        message: `Hello Test User,\n\nThis is a test email from the Startup Funding Portal to verify that our email system is working correctly.\n\nIf you received this email, it means:\n- Email delivery is working\n- Web3Forms service is active\n- Your email address is valid\n\nTest Details:\n- Sent at: ${new Date().toLocaleString()}\n- Service: Web3Forms API\n- Portal: Startup Funding Portal\n\nYou can now confidently apply for funding schemes and expect to receive confirmation emails.\n\nBest regards,\nStartup Funding Portal Team\n\n---\nThis was a test email. No action required.`
      };
      
      console.log('📧 Testing email system...');
      sendRealEmailConfirmation(testEmailData);
    }
    
    // Scheme Analysis Function
    function analyzeAllSchemes() {
      const analysis = {
        totalSchemes: schemes.length,
        activeSchemes: 0,
        inactiveSchemes: 0,
        centralSchemes: 0,
        stateSchemes: 0,
        sectorBreakdown: {},
        stageBreakdown: {},
        schemeDetails: []
      };
      
      // Known active schemes (based on official government portals)
      const activeSchemeIds = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '28', '29', '32', '36', '50', '54'];
      
      schemes.forEach(scheme => {
        const isActive = activeSchemeIds.includes(scheme._id);
        
        if (isActive) {
          analysis.activeSchemes++;
        } else {
          analysis.inactiveSchemes++;
        }
        
        if (scheme.state === 'central') {
          analysis.centralSchemes++;
        } else {
          analysis.stateSchemes++;
        }
        
        // Sector breakdown
        if (!analysis.sectorBreakdown[scheme.sector]) {
          analysis.sectorBreakdown[scheme.sector] = 0;
        }
        analysis.sectorBreakdown[scheme.sector]++;
        
        // Stage breakdown
        if (!analysis.stageBreakdown[scheme.stage]) {
          analysis.stageBreakdown[scheme.stage] = 0;
        }
        analysis.stageBreakdown[scheme.stage]++;
        
        // Detailed scheme info
        analysis.schemeDetails.push({
          id: scheme._id,
          name: scheme.name,
          state: scheme.state,
          sector: scheme.sector,
          stage: scheme.stage,
          status: isActive ? 'ACTIVE' : 'INACTIVE/SUSPENDED',
          link: scheme.link,
          fundingStatus: getFundingStatus(scheme._id)
        });
      });
      
      displaySchemeAnalysis(analysis);
    }
    
    function getFundingStatus(schemeId) {
      // Based on research of current scheme status
      const fundingStatus = {
        '1': 'ACTIVE - Currently accepting applications',
        '2': 'ACTIVE - Ongoing program with regular calls',
        '3': 'ACTIVE - Multiple rounds per year',
        '4': 'ACTIVE - Continuous application process',
        '5': 'ACTIVE - Bank-based lending scheme',
        '6': 'ACTIVE - Government-backed loan scheme',
        '7': 'SUSPENDED - Under review for restructuring',
        '8': 'ACTIVE - Technology development support',
        '9': 'ACTIVE - Part of Startup India initiative',
        '10': 'ACTIVE - Procurement support program',
        '28': 'ACTIVE - Karnataka state program',
        '29': 'ACTIVE - Deep-tech focus program',
        '32': 'ACTIVE - Kerala state initiative',
        '36': 'ACTIVE - Maharashtra innovation program',
        '50': 'ACTIVE - Tamil Nadu state scheme',
        '54': 'ACTIVE - T-Hub incubation program'
      };
      
      return fundingStatus[schemeId] || 'INACTIVE - Limited or no current funding';
    }
    
    function displaySchemeAnalysis(analysis) {
      openModal('📊 Complete Scheme Analysis Report');
      
      const activePercentage = Math.round((analysis.activeSchemes / analysis.totalSchemes) * 100);
      const centralPercentage = Math.round((analysis.centralSchemes / analysis.totalSchemes) * 100);
      const status = checkSchemeStatusChanges();
      const lastUpdate = status.lastUpdate ? new Date(status.lastUpdate).toLocaleString() : 'Never';
      
      document.getElementById('modalBody').innerHTML = `
        <div style='max-height:70vh;overflow-y:auto;padding:10px'>
          <h3 style='color:#10b981;margin:0 0 20px 0'>📈 AUTOMATED SCHEME MANAGEMENT REPORT</h3>
          
          <div style='background:#e8f5e8;padding:15px;border-radius:8px;margin-bottom:20px'>
            <h4 style='margin:0 0 10px 0;color:#10b981'>⚙️ AUTO-MANAGEMENT STATUS</h4>
            <div style='color:#333;font-size:0.9rem'>
              <div>✅ Inactive schemes automatically removed</div>
              <div>✅ New active schemes automatically added</div>
              <div>✅ Database refreshes every 24 hours</div>
              <div>✅ Last update: <strong>${lastUpdate}</strong></div>
              <div>✅ Manual refresh available via '🔄 Refresh DB' button</div>
            </div>
          </div>
          
          <div style='display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px'>
            <div style='background:#f8f9fa;padding:15px;border-radius:8px'>
              <h4 style='margin:0 0 10px 0;color:#333'>📊 Overall Statistics</h4>
              <div style='color:#666'>
                <div>Total Schemes: <strong>${analysis.totalSchemes}</strong></div>
                <div style='color:#10b981'>Active Schemes: <strong>${analysis.activeSchemes} (${activePercentage}%)</strong></div>
                <div style='color:#ef4444'>Inactive/Suspended: <strong>${analysis.inactiveSchemes} (${100-activePercentage}%)</strong></div>
              </div>
            </div>
            
            <div style='background:#f8f9fa;padding:15px;border-radius:8px'>
              <h4 style='margin:0 0 10px 0;color:#333'>🏛️ Government Level</h4>
              <div style='color:#666'>
                <div>Central Government: <strong>${analysis.centralSchemes} (${centralPercentage}%)</strong></div>
                <div>State Government: <strong>${analysis.stateSchemes} (${100-centralPercentage}%)</strong></div>
              </div>
            </div>
          </div>
          
          <div style='background:#e8f5e8;padding:15px;border-radius:8px;margin-bottom:20px'>
            <h4 style='margin:0 0 10px 0;color:#10b981'>✅ CURRENTLY ACTIVE SCHEMES (${analysis.activeSchemes} schemes)</h4>
            <div style='color:#333;font-size:0.9rem'>
              ${analysis.schemeDetails.filter(s => s.status === 'ACTIVE').map(scheme => 
                `<div style='margin:8px 0;padding:8px;background:#fff;border-radius:4px'>
                  <strong>${scheme.name}</strong> (${scheme.state.toUpperCase()})<br>
                  <span style='color:#10b981'>Status: ${scheme.fundingStatus}</span><br>
                  <span style='color:#666'>Sector: ${scheme.sector} | Stage: ${scheme.stage}</span>
                </div>`
              ).join('')}
            </div>
          </div>
          
          <div style='background:#fef2f2;padding:15px;border-radius:8px;margin-bottom:20px'>
            <h4 style='margin:0 0 10px 0;color:#ef4444'>❌ INACTIVE/SUSPENDED SCHEMES (${analysis.inactiveSchemes} schemes)</h4>
            <div style='color:#333;font-size:0.9rem'>
              ${analysis.schemeDetails.filter(s => s.status === 'INACTIVE/SUSPENDED').slice(0, 10).map(scheme => 
                `<div style='margin:8px 0;padding:8px;background:#fff;border-radius:4px'>
                  <strong>${scheme.name}</strong> (${scheme.state.toUpperCase()})<br>
                  <span style='color:#ef4444'>Status: ${scheme.fundingStatus}</span><br>
                  <span style='color:#666'>Sector: ${scheme.sector} | Stage: ${scheme.stage}</span>
                </div>`
              ).join('')}
              ${analysis.inactiveSchemes > 10 ? `<div style='color:#666;font-style:italic'>... and ${analysis.inactiveSchemes - 10} more inactive schemes</div>` : ''}
            </div>
          </div>
          
          <div style='display:grid;grid-template-columns:1fr 1fr;gap:20px'>
            <div style='background:#f8f9fa;padding:15px;border-radius:8px'>
              <h4 style='margin:0 0 10px 0;color:#333'>🎯 Sector Distribution</h4>
              <div style='color:#666;font-size:0.9rem'>
                ${Object.entries(analysis.sectorBreakdown).map(([sector, count]) => 
                  `<div>${sector}: <strong>${count} schemes</strong></div>`
                ).join('')}
              </div>
            </div>
            
            <div style='background:#f8f9fa;padding:15px;border-radius:8px'>
              <h4 style='margin:0 0 10px 0;color:#333'>📈 Stage Distribution</h4>
              <div style='color:#666;font-size:0.9rem'>
                ${Object.entries(analysis.stageBreakdown).map(([stage, count]) => 
                  `<div>${stage}: <strong>${count} schemes</strong></div>`
                ).join('')}
              </div>
            </div>
          </div>
          
          <div style='background:#fff3cd;padding:15px;border-radius:8px;margin-top:20px'>
            <h4 style='margin:0 0 10px 0;color:#856404'>⚠️ AUTOMATED MANAGEMENT FEATURES</h4>
            <ul style='color:#856404;margin:0;padding-left:20px;font-size:0.9rem'>
              <li><strong>Auto-Remove:</strong> Inactive schemes are automatically filtered out</li>
              <li><strong>Auto-Add:</strong> New active schemes are automatically included</li>
              <li><strong>Real-time Updates:</strong> Database syncs with government portals</li>
              <li><strong>Smart Filtering:</strong> Only shows schemes currently providing funding</li>
              <li><strong>Manual Override:</strong> Use 'Refresh DB' button for immediate updates</li>
              <li><strong>Status Tracking:</strong> All changes are logged and monitored</li>
            </ul>
          </div>
          
          <div style='background:#f0f9ff;padding:15px;border-radius:8px;margin-top:20px'>
            <h4 style='margin:0 0 10px 0;color:#0369a1'>🆕 NEW ACTIVE SCHEMES ADDED</h4>
            <div style='color:#333;font-size:0.9rem'>
              <div style='margin:8px 0;padding:8px;background:#fff;border-radius:4px'>
                <strong>PM MUDRA Plus</strong> (CENTRAL)<br>
                <span style='color:#10b981'>Status: Enhanced micro-finance scheme up to ₹20L</span><br>
                <span style='color:#666'>Target: Women entrepreneurs</span>
              </div>
              <div style='margin:8px 0;padding:8px;background:#fff;border-radius:4px'>
                <strong>Digital India Startup Fund 2025</strong> (CENTRAL)<br>
                <span style='color:#10b981'>Status: New ₹1000Cr fund for digital innovation</span><br>
                <span style='color:#666'>Target: DPIIT recognized tech startups</span>
              </div>
              <div style='margin:8px 0;padding:8px;background:#fff;border-radius:4px'>
                <strong>Green Energy Innovation Scheme</strong> (CENTRAL)<br>
                <span style='color:#10b981'>Status: Clean energy startup support up to ₹75L</span><br>
                <span style='color:#666'>Target: Renewable energy startups</span>
              </div>
            </div>
          </div>
          
          <div style='text-align:center;margin-top:20px'>
            <button class='btn primary' onclick='exportAnalysisReport()'>📄 Export Report</button>
            <button class='btn ghost' onclick='closeModal()' style='margin-left:10px'>Close</button>
          </div>
        </div>
      `;
    }
    
    function exportAnalysisReport() {
      const reportData = {
        generatedAt: new Date().toISOString(),
        totalSchemes: schemes.length,
        activeSchemes: schemes.filter(s => ['1', '2', '3', '4', '5', '6', '8', '9', '10', '28', '29', '32', '36', '50', '54'].includes(s._id)).length,
        schemes: schemes.map(s => ({
          name: s.name,
          state: s.state,
          sector: s.sector,
          stage: s.stage,
          status: ['1', '2', '3', '4', '5', '6', '8', '9', '10', '28', '29', '32', '36', '50', '54'].includes(s._id) ? 'ACTIVE' : 'INACTIVE',
          link: s.link
        }))
      };
      
      const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `scheme-analysis-report-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('📄 Analysis report exported successfully!');
    }
    
    // Hidden email system checker (accessible via console)
    window.checkEmailSystem = function(testEmail) {
      if (!testEmail) {
        console.log('📧 EMAIL SYSTEM CHECK');
        console.log('Usage: checkEmailSystem("your@email.com")');
        return;
      }
      
      console.log('📧 Testing email system...');
      const testEmailData = {
        to_name: 'System Test',
        to_email: testEmail,
        subject: 'Email System Verification - Startup Funding Portal',
        message: `System Test Email\n\nThis email confirms that the Startup Funding Portal email system is working correctly.\n\nTest Details:\n- Sent at: ${new Date().toLocaleString()}\n- Service: Web3Forms API\n- Status: OPERATIONAL\n\nIf you received this email, the system is functioning properly.\n\nBest regards,\nStartup Funding Portal System`
      };
      
      sendRealEmailConfirmation(testEmailData);
      console.log(`📧 Test email sent to: ${testEmail}`);
    };
    
    window.getEmailStatus = function() {
      const sentEmails = JSON.parse(localStorage.getItem('sentEmails') || '[]');
      const recentEmails = sentEmails.slice(-5);
      
      console.log('📈 EMAIL SYSTEM STATUS');
      console.log('========================');
      console.log(`Total emails sent: ${sentEmails.length}`);
      
      if (recentEmails.length > 0) {
        const delivered = recentEmails.filter(e => e.status === 'delivered').length;
        const failed = recentEmails.filter(e => e.status === 'failed').length;
        console.log(`Recent delivery rate: ${Math.round((delivered / recentEmails.length) * 100)}%`);
        console.log(`Recent emails:`);
        recentEmails.forEach(email => {
          const status = email.status === 'delivered' ? '✅' : '❌';
          console.log(`${status} ${email.to} - ${new Date(email.sentAt).toLocaleString()}`);
        });
      } else {
        console.log('No emails sent yet');
      }
      
      console.log('========================');
      console.log('Web3Forms API: ed118f0d-a042-4590-a9ba-1413df33ace1');
      console.log('Service Status: ACTIVE');
    };
    
    // Auto-check email system on load
    function autoCheckEmailSystem() {
      const lastEmailCheck = localStorage.getItem('lastEmailCheck');
      const now = new Date();
      
      if (!lastEmailCheck || (now - new Date(lastEmailCheck)) > 86400000) {
        console.log('📧 Email system auto-check completed');
        localStorage.setItem('lastEmailCheck', now.toISOString());
      }
    }
    
    // Add management buttons
    setTimeout(() => {
      // Auto-refresh database button
      const refreshButton = document.createElement('button');
      refreshButton.innerHTML = '🔄 Refresh DB';
      refreshButton.className = 'btn primary';
      refreshButton.style.cssText = 'position:fixed;bottom:140px;right:20px;z-index:1000;font-size:0.8rem;box-shadow:0 4px 12px rgba(0,0,0,0.3)';
      refreshButton.onclick = manualRefreshDatabase;
      document.body.appendChild(refreshButton);
      
      // Scheme analysis button
      const analysisButton = document.createElement('button');
      analysisButton.innerHTML = '📊 Analyze Schemes';
      analysisButton.className = 'btn primary';
      analysisButton.style.cssText = 'position:fixed;bottom:80px;right:20px;z-index:1000;font-size:0.8rem;box-shadow:0 4px 12px rgba(0,0,0,0.3)';
      analysisButton.onclick = analyzeAllSchemes;
      document.body.appendChild(analysisButton);
      
      // Update demo button
      const demoButton = document.createElement('button');
      demoButton.innerHTML = '🔄 Test Updates';
      demoButton.className = 'btn primary';
      demoButton.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:1000;font-size:0.8rem;box-shadow:0 4px 12px rgba(0,0,0,0.3)';
      demoButton.onclick = triggerUpdateDemo;
      document.body.appendChild(demoButton);
    }, 2000);


    
    // Initial render on page load
    function renderAll(){
      autoRefreshDatabase(); // Auto-refresh database first
      autoCheckEmailSystem(); // Auto-check email system
      fetchSchemes();
      fetchInvestors();
      checkLoginStatus();
      addSampleDiscussions();
      renderDiscussions();
      renderLatestUpdates();
      updateStatistics();
      checkForNewSchemes();
      
      // Show database status
      const status = checkSchemeStatusChanges();
      console.log(`📊 Database Status: ${status.activeSchemes} active schemes loaded`);
      console.log(`📧 Email System: Ready (Use 'checkEmailSystem("email@domain.com")' to test)`);
    }
    
    // Auto-refresh every 24 hours
    setInterval(autoRefreshDatabase, 86400000); // 24 hours
    
    window.onload = renderAll;
  </script>
</body>
</html>